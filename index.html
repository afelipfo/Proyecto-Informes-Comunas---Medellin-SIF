<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión 2025 - Secretaría de Infraestructura Física (Versión Optimizada)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary-color: #0d47a1;
            --primary-color-dark: #003D6B;
            --secondary-color: #f57c00;
            --text-color: #212121;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --light-gray: #e9ecef;
        }
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-color-dark));
            color: white;
            text-align: center;
            padding: 40px 20px 50px 20px;
            border-bottom: 5px solid var(--secondary-color);
        }
        .header-logo {
            max-width: 280px;
            margin-bottom: 25px;
            animation: fadeInDown 1s ease-in-out;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        header h1 {
            margin: 0;
            font-size: 2.6em;
            font-weight: 900;
            line-height: 1.2;
            animation: fadeInUp 1s ease-in-out;
        }
        header p.subheading {
            font-size: 1.2em;
            margin: 10px 0 0 0;
            font-weight: 300;
            opacity: 0.9;
            animation: fadeInUp 1s ease-in-out 0.2s;
            animation-fill-mode: backwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        nav {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(8px);
            z-index: 999;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        nav .container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            padding: 5px 20px;
        }
        nav a {
            color: var(--primary-color);
            text-decoration: none;
            padding: 10px 15px;
            font-weight: 700;
            font-size: 0.9em;
            transition: color 0.3s, background-color 0.3s;
            border-radius: 5px;
        }
        nav a:hover {
            color: white;
            background-color: var(--secondary-color);
        }
        section {
            padding: 60px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        main > section:first-of-type {
            padding-top: 40px; /* Ajuste para el primer elemento */
        }
        main > section:last-of-type {
            border-bottom: none;
        }
        section h2 {
            font-size: 2.2em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 30px;
            text-align: center;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        .card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        .card h3 {
            margin-top: 0;
            font-size: 1.5em;
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .stat-box {
            text-align: center;
            justify-content: center;
        }
        .stat-number {
            font-size: 3.5em;
            font-weight: 900;
            color: var(--primary-color);
            line-height: 1.1;
        }
        .stat-label {
            font-size: 1.1em;
            font-weight: 400;
            color: #555;
        }
        .bar-chart {
            width: 100%;
            margin-top: 20px;
        }
        .bar-chart-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .bar-label {
            width: 220px;
            flex-shrink: 0;
        }
        .bar-container {
            flex-grow: 1;
            background: #e0e0e0;
            border-radius: 5px;
            height: 22px;
        }
        .bar {
            background: linear-gradient(90deg, #ffb74d, var(--secondary-color));
            height: 100%;
            border-radius: 5px;
            text-align: right;
            padding-right: 8px;
            box-sizing: border-box;
            color: white;
            font-weight: 700;
            line-height: 22px;
            transition: width 1s ease-out;
            font-size: 0.9em;
        }
        ul {
            line-height: 1.8;
            padding-left: 20px;
            flex-grow: 1;
        }
        li::marker {
            color: var(--secondary-color);
        }
        .highlight {
            color: var(--secondary-color);
            font-weight: 700;
        }
        .date-stamp {
            font-weight: 400;
            font-style: italic;
            text-align: right;
            margin-top: 15px;
            font-size: 0.9em;
            color: #777;
        }
        
        .consulta-comuna-container {
             display: flex;
             flex-direction: column;
             gap: 20px;
             padding: 30px;
             box-sizing: border-box;
             background: #fdfdff;
        }
        
        .consulta-comuna-container h3 {
             font-size: 1.3em;
             margin-top: 0;
             color: var(--primary-color);
        }
        .consulta-comuna-container p {
            font-size: 0.9em;
            color: #555;
            line-height: 1.5;
            margin-bottom: 0;
        }
        .consulta-comuna-container label {
            font-size: 1em;
            font-weight: 600;
            color: var(--text-color);
            display: block;
            margin-bottom: 10px;
        }
        .consulta-comuna-container select {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 1px solid #ced4da;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            background-color: var(--bg-color);
        }
        .consulta-comuna-container button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .consulta-comuna-container button:hover {
            background-color: #e66300;
        }

        #indicadores-cta {
            background-color: var(--light-gray);
            text-align: center;
            padding: 50px 20px;
        }
        #indicadores-cta h2 {
            font-size: 2em;
            border-bottom: none;
            color: var(--primary-color-dark);
        }
        #indicadores-cta p {
            font-size: 1.1em;
            max-width: 650px;
            margin: -15px auto 30px auto;
            color: #555;
            line-height: 1.6;
        }
        .cta-button {
            display: inline-block;
            background: linear-gradient(45deg, var(--secondary-color), #ff8f00);
            color: white;
            text-decoration: none;
            padding: 18px 40px;
            font-size: 1.2em;
            font-weight: 700;
            border-radius: 50px;
            box-shadow: 0 8px 20px rgba(245, 124, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(245, 124, 0, 0.4);
        }
        .cta-button .fa-solid {
            margin-right: 10px;
            font-size: 1em;
        }
        
        /* Estilos para las pestañas de Gestión Estratégica */
        .tabs-container {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .tabs-nav {
            display: flex;
            background-color: var(--light-gray);
        }
        .tab-link {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1em;
            color: var(--primary-color);
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tab-link:hover {
            background-color: #e0e6ef;
        }
        .tab-link.active {
            color: var(--primary-color-dark);
            border-bottom-color: var(--secondary-color);
        }
        .tab-pane {
            display: none;
            padding: 30px;
            animation: fadeIn 0.5s;
        }
        .tab-pane.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #chat-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1001;
            transition: transform 0.3s;
        }
        #chat-fab:hover {
            transform: scale(1.1);
        }
        #chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 420px;
            max-width: 90vw;
            height: 80vh;
            max-height: 700px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1002;
            transform: scale(0.5);
            transform-origin: bottom right;
            opacity: 0;
            pointer-events: none;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #chat-window.visible {
            transform: scale(1);
            opacity: 1;
            pointer-events: auto;
        }
        .chat-header {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        #chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .chat-body {
            font-family: 'Inter', sans-serif;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #f0f4f8;
            height: 100%;
            overflow: hidden;
        }
        .chat-bubble-user { background-color: #2563EB; color: white; }
        .chat-bubble-bot { background-color: #E2E8F0; color: #1E293B; }
        #chat-messages-container::-webkit-scrollbar { width: 6px; }
        #chat-messages-container::-webkit-scrollbar-track { background: #CBD5E1; }
        #chat-messages-container::-webkit-scrollbar-thumb { background: #94A3B8; border-radius: 3px; }
        #chat-messages-container::-webkit-scrollbar-thumb:hover { background: #64748B; }
        .option-btn {
            transition: all 0.2s ease-in-out;
            border: 1px solid #CBD5E1;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #3B82F6;
        }

        /* MEJORA: Estilos para animación en scroll */
        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform;
        }
        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

    </style>
</head>
<body>

    <header>
        <img src="logo_footer.png" alt="Logo Alcaldía de Medellín" class="header-logo">
        <h1>Gestión 2025 - Secretaría de Infraestructura Física</h1>
        <p class="subheading">Alcaldía de Medellín - Distrito Especial de Ciencia, Tecnología e Innovación.</p>
    </header>
    
    <nav>
        <div class="container">
            <a href="#malla-vial">Malla Vial</a>
            <a href="#infra-verde">Infraestructura Verde</a>
            <a href="#emergencias">Emergencias</a>
            <a href="#espacios-publicos">Espacios Públicos</a>
            <a href="#proyectos-estrategicos">Proyectos Estratégicos</a>
            <a href="#futuro">Gestión Estratégica</a>
            <a href="pp.html" target="_blank" rel="noopener noreferrer">Presupuesto Participativo</a>
        </div>
    </nav>

    <main class="container">

        <section id="consulta-comuna">
            <div class="card reveal-on-scroll" style="padding: 0; overflow: hidden;">
                <h3 style="padding: 30px 30px 0 30px; margin-bottom: 0;">🔎 Consulta Detallada por Comuna</h3>
                <div class="consulta-comuna-container">
                    <h3>Filtros de Consulta</h3>
                    <p>Usa el siguiente menú para seleccionar una comuna o corregimiento y ver su reporte detallado de intervenciones.</p>
                    <div>
                        <label for="comuna-select">Filtrar por lista:</label>
                        <select id="comuna-select">
                            <option value="" disabled selected>-- Escoge una opción --</option>
                        </select>
                    </div>
                    <button onclick="abrirReporte()">Ver Reporte Detallado</button>
                </div>
            </div>
        </section>

        <section id="indicadores-cta" class="reveal-on-scroll">
            <h2><i class="fa-solid fa-chart-line"></i> Indicadores - SIF</h2>
            <p>Explore los datos detallados y el progreso de nuestros proyectos estratégicos. Acceda a las métricas clave y siga en tiempo real el avance de las metas que transforman a Medellín.</p>
            <a href="indicadores.html" class="cta-button" target="_blank" rel="noopener noreferrer">
                <i class="fa-solid fa-arrow-up-right-from-square"></i>Ver Tablero de Indicadores
            </a>
        </section>

        <section id="malla-vial">
            <h2 class="reveal-on-scroll">🛣️ Conectando la Ciudad: Recuperación de la Malla Vial</h2>
            <div class="grid">
                <div class="card reveal-on-scroll">
                    <h3>Nuestra Gestión</h3>
                    <p>Mediante intervenciones integrales que incluyen reparación de baches, rehabilitación de vías y obras complementarias, hemos logrado una importante recuperación de la malla vial. Estas labores, coordinadas con múltiples cuadrillas, mejoran la transitabilidad y seguridad vial para todos.</p>
                </div>
                <div class="card stat-box reveal-on-scroll">
                    <div class="stat-number">+<span id="stat-huecos">0</span></div>
                    <div class="stat-label">Huecos tapados en la ciudad y corregimientos</div>
                </div>
            </div>
            
            <div class="card reveal-on-scroll" style="margin-top: 30px;">
                <h3>📊 Impacto Total por Comuna (Huecos Tapados)</h3>
                <div class="bar-chart" id="barChartContainer">
                    </div>
            </div>
        </section>
        
        <section id="infra-verde">
            <h2 class="reveal-on-scroll">🌳 Infraestructura Verde</h2>
            <div class="grid">
                <div class="card reveal-on-scroll">
                    <h3>Nuevos Espacios Verdes</h3>
                    <ul>
                        <li><span class="highlight" id="infra-corredores"></span> nuevos corredores verdes creados en 2024 (Manrique, Palmas, Av. 33 tramo 2).</li>
                        <li><span class="highlight" id="infra-puentes"></span> nuevos puentes verdes para conectar cerros tutelares.</li>
                        <li>Total: <span class="highlight" id="infra-metros-verdes"></span> de nuevos espacios verdes.</li>
                        <li>Obras iniciadas en Av. Las Vegas y La 70 con inversión de <span class="highlight" id="infra-inversion-vegas"></span>.</li>
                    </ul>
                </div>
                 <div class="card reveal-on-scroll">
                    <h3>Mantenimiento y Cuidado</h3>
                    <ul>
                        <li>A la fecha van <span class="highlight" id="mant-jardineros"></span> jardineros desplegados en toda la ciudad.</li>
                        <li><span class="highlight" id="mant-metros-conservacion"></span> en conservación de zonas verdes, árboles y jardines.</li>
                        <li><span class="highlight" id="mant-individuos-arboreos"></span> individuos arbóreos juveniles en conservación.</li>
                        <li><span class="highlight" id="mant-plantas-sembradas"></span> plantas sembradas para el establecimiento de jardines.</li>
                        <li>Inversión de <span class="highlight" id="mant-inversion-total"></span>.</li>
                    </ul>
                </div>
                 <div class="card reveal-on-scroll">
                    <h3>Renovación Puente 4 Sur</h3>
                    <p>Se intervinieron más de <span class="highlight" id="p4sur-inversion"></span> en la recuperación del urbanismo superior del puente, sembrando más de <span class="highlight" id="p4sur-plantas"></span> plantas para embellecer este icónico entorno.</p>
                     <ul>
                         <li id="p4sur-muros"></li>
                         <li id="p4sur-materas"></li>
                         <li id="p4sur-pintura"></li>
                     </ul>
                     <div class="date-stamp" style="margin-top:auto;">Corte: <span id="date-p4sur"></span></div>
                </div>
            </div>
        </section>

        <section id="emergencias">
            <h2 class="reveal-on-scroll">👷🏽‍♀️ Respuesta Inmediata: Gestión de Emergencias</h2>
            <p style="text-align: center; max-width: 800px; margin: 0 auto 40px;" class="reveal-on-scroll">En articulación con el DAGRD, removemos material y habilitamos puntos críticos para garantizar la seguridad de los ciudadanos.</p>
            <div class="grid">
                 <div class="card stat-box reveal-on-scroll">
                    <div class="stat-number">&gt;<span id="stat-material-removido">0</span></div>
                    <div class="stat-label">De material removido</div>
                </div>
                <div class="card stat-box reveal-on-scroll">
                    <div class="stat-number">&gt;<span id="stat-personas-emergencias">0</span></div>
                    <div class="stat-label">Personas dedicadas a estas labores</div>
                </div>
                <div class="card reveal-on-scroll">
                    <h3>Zonas Atendidas</h3>
                    <ul>
                        <li><b>Corregimientos:</b> Altavista, San Antonio de Prado, Santa Elena, San Cristóbal.</li>
                        <li><b>Zonas Urbanas:</b> Los Balsos, El Popular, El Poblado, Llanaditas, la Zona Industrial, Villatina, Picacho y Santo Domingo.</li>
                    </ul>
                </div>
            </div>
             <div class="date-stamp reveal-on-scroll">Corte: <span id="date-emergencias"></span></div>
        </section>

        <section id="espacios-publicos">
            <h2 class="reveal-on-scroll">🏞️ Espacios para la Gente: Renovación de Parques</h2>
             <div class="grid">
                <div class="card stat-box reveal-on-scroll">
                    <div class="stat-number" id="parques-renovados">0</div>
                    <div class="stat-label">Espacios públicos renovados</div>
                </div>
                <div class="card stat-box reveal-on-scroll">
                    <div class="stat-number">&gt;<span id="parques-metros-intervenidos">0</span></div>
                    <div class="stat-label">De espacio público intervenido</div>
                </div>
                <div class="card reveal-on-scroll">
                    <h3>Parques finalizados</h3>
                    <ul id="parques-finalizados-lista">
                    </ul>
                </div>
            </div>
            <div class="card reveal-on-scroll" style="margin-top: 30px;">
                <h3>Proyectos en Curso y Futuros</h3>
                <ul>
                    <li><b>En San Antonio de Prado (Presupuesto Participativo):</b> Se avanza en 4 parques. 
                        <span class="highlight">El Limonar II</span> y <span class="highlight">Rosaleda</span> ya están finalizados. 
                        El parque <span class="highlight">Prado II</span> registra un avance del 60% y <span class="highlight">Corregiduría</span> un 40%.</li>
                    <li><b>Próxima Gran Inversión (Licitación No. 0070007732):</b> Se destinarán más de <span class="highlight" id="parques-inversion-futura"></span> para mejorar y construir <span class="highlight" id="parques-futuros-cantidad"></span> parques con el programa Juguemos en el Parque, impactando 13 comunas y un corregimiento.</li>
                </ul>
            </div>
        </section>
        
        <section id="proyectos-estrategicos">
            <h2 class="reveal-on-scroll">🏗️ Proyectos Estratégicos que Transforman Territorios</h2>
            <div class="grid">
                 <div class="card reveal-on-scroll">
                    <h3>Proyectos Urbanos Integrales (PUI)</h3>
                    <p>Entregamos <span class="highlight" id="pui-entregados"></span> que fortalecen el espacio público con una inversión de <span class="highlight" id="pui-inversion"></span>, beneficiando a <span class="highlight" id="pui-habitantes"></span> habitantes.</p>
                    <ul>
                        <li>Paseos Urbanos carreras 83 y 84 (PUI Noroccidental, Comuna 6).</li>
                        <li>Parque Deportivo Fuente Clara (PUI Iguaná, Comuna 7).</li>
                        <li>Conectividad Estación Cable Las Torres-Cerro Los Valores (PUI Centro Oriental).</li>
                    </ul>
                </div>
                <div class="card reveal-on-scroll">
                    <h3>Presupuesto Participativo</h3>
                     <p>Intervención de <span class="highlight" id="pp-puntos"></span> (20 vías y 27 andenes) en las comunas 1, 4, 16, 50 y 80, con un avance físico superior al <span class="highlight" id="pp-avance"></span>. Por buen desempeño, se adicionaron <span class="highlight" id="pp-adicion"></span> para 12 nuevos frentes (<span id="pp-total-frentes"></span> total).</p>
                </div>
                 <div class="card reveal-on-scroll">
                    <h3>Obras de Estabilización</h3>
                    <p>Trabajamos en la contención y mitigación en <span class="highlight" id="o-estab-puntos"></span> de la ciudad, de los cuales ya se han intervenido <span class="highlight" id="o-estab-intervenidos"></span>.</p>
                    <ul>
                        <li><b>Proyección:</b> <span id="o-estab-proyeccion"></span> de intervención.</li>
                        <li><b>Inversión:</b> Más de <span id="o-estab-inversion"></span>.</li>
                        <li><b>Comunas:</b> Doce de Octubre, Popular, Manrique, Villa Hermosa, Buenos Aires, El Poblado, Guayabal, Belén, La América, San Javier, Robledo y San Cristóbal.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="futuro">
            <h2 class="reveal-on-scroll">🚀 Gestión Estratégica</h2>
            <div class="tabs-container reveal-on-scroll">
                <div class="tabs-nav">
                    <button class="tab-link active" data-target="tab-cuadrillas">
                        <i class="fa-solid fa-users"></i> Cuadrillas del Alcalde
                    </button>
                    <button class="tab-link" data-target="tab-licitaciones">
                        <i class="fa-solid fa-file-signature"></i> Contratos en Licitación
                    </button>
                </div>
                <div class="tabs-content">
                    <div id="tab-cuadrillas" class="tab-pane active">
                        <h3><i class="fa-solid fa-helmet-safety"></i> Atención de Contingencias</h3>
                        <p><span id="cuadrillas-contrato-objeto"></span> A LA FECHA, SE HAN ATENDIDO <span class="highlight" id="cuadrillas-puntos-atendidos"></span>.</p>
                        <ul>
                            <li>Verificación y reparación de defensas viales, barandas y pasamanos.</li>
                            <li>Mantenimiento priorizado de parques y mobiliario urbano.</li>
                            <li>Logística integral para lavado y pintura de estructuras viales.</li>
                        </ul>
                    </div>
                    <div id="tab-licitaciones" class="tab-pane">
                        <h3><i class="fa-solid fa-gavel"></i> Obras Futuras Aseguradas</h3>
                        <p>Aseguramos la continuidad de las obras y el mantenimiento de la infraestructura de la ciudad con <span class="highlight" id="licit-procesos-activos"></span> actualmente activos para:</p>
                        <ul id="licit-lista-tipos">
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div id="chat-fab">
        <span>💬</span>
    </div>
    
    <div id="chat-window">
        <div class="chat-header">
            <span>Asistente Virtual SIF</span>
            <button id="chat-close-btn">✖</button>
        </div>
        <div class="chat-body">
            <div id="chat-messages-container" class="flex-grow p-4 overflow-y-auto space-y-4">
            </div>
            
            <div id="options-container" class="p-3 border-t bg-slate-50 space-y-3">
                <div id="navigation-controls" class="flex justify-between items-center text-sm mb-2">
                    <button id="back-btn" class="text-blue-600 hover:underline hidden">← Volver</button>
                    <div id="breadcrumb-container" class="text-slate-500 text-right font-medium"></div>
                </div>
                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                </div>
            </div>

            <div class="p-4 border-t bg-white rounded-b-xl">
                <div class="flex items-center space-x-2">
                    <input type="text" id="chat-input" placeholder="Busca un informe o palabra clave..." class="flex-grow border rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="send-btn" class="bg-blue-500 text-white rounded-full p-3 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const pageData = {
            stats: {
                huecosTapados: "13,822",
                materialRemovido: "60,000 m³",
                personasEmergencias: "300",
                parquesRenovados: "17",
                parquesMetrosIntervenidos: "11,890 m²"
            },
            dates: {
                cortePuente4Sur: "13 de junio de 2025",
                corteEmergencias: "1 de julio de 2025"
            },
            infraVerde: {
                corredores: 3,
                puentes: 3,
                metrosVerdes: "5,000 m²",
                inversionVegas: "$1.120 millones",
                jardineros: "540",
                metrosConservacion: "5,084 m²",
                individuosArboreos: "13,136",
                plantasSembradas: "15,012",
                inversionMantenimiento: "$40.000 millones"
            },
            puente4Sur: {
                inversion: "$1.330 millones",
                plantas: "4.300",
                muros: "749 metros de muros verdes ubicados a lo largo del puente.",
                materas: "Se instalaron 86 metros de materas en madera inmunizada y 296 metros en madera plástica.",
                pintura: "Los trabajos realizados incluyeron un completo proceso de pintura de los pasamanos superiores y en 1.300 paneles del puente."
            },
            parques: {
                listaFinalizados: [
                   "<b>Santa Cruz:</b> Villa del Socorro I y II, Pablo VI.",
                   "<b>Manrique:</b> Oasis del Jardín.",
                   "<b>Aranjuez:</b> La Piñuela, Palermo.",
                   "<b>Doce de Octubre:</b> Parque de los Jubilados.",
                   "<b>Villa Hermosa:</b> Jardín Circunvalar.",
                   "<b>Buenos Aires:</b> La Pastora, Barrios de Jesús.",
                   "<b>El Poblado:</b> Finito.",
                   "<b>Guayabal:</b> El Rodeo, Cristo Rey.",
                   "<b>Santa Elena:</b> Piedras Gordas."
                ],
                inversionFutura: "$20.000 millones",
                cantidadFuturos: 29
            },
            proyectosEstrategicos: {
                puiEntregados: "4 PUI",
                puiInversion: "$16.000 millones",
                puiHabitantes: "209.000",
                ppPuntos: "47 puntos",
                ppAvance: "90%",
                ppAdicion: "$4.590 millones",
                ppTotalFrentes: 59,
                obrasEstabilizacionPuntos: "40 puntos",
                obrasEstabilizacionIntervenidos: 34,
                obrasEstabilizacionProyeccion: "1200 m",
                obrasEstabilizacionInversion: "$11.300 millones"
            },
            gestionEstrategica: {
                cuadrillasContrato: "Contrato Interadministrativo de $23.900 Millones para Atender Contingencias en el Espacio Público.",
                cuadrillasPuntosAtendidos: "152 puntos",
                licitacionesActivas: "12 procesos de licitación",
                licitacionesTipos: [
                    "Malla vial", "Contención y mitigación", "Construcción y mejoramiento de parques",
                    "Construcción y mejoramiento de andenes", "Plan vial rural", "Conservación de zonas verdes"
                ]
            },
            barChartData: [
                { label: 'Comuna 10 – La Candelaria', value: 1178 }, { label: 'Comuna 7 – Robledo', value: 1095 },
                { label: 'Comuna 11 – Laureles', value: 965 }, { label: 'Comuna 3 – Manrique', value: 950 },
                { label: 'Comuna 5 – Castilla', value: 895 }, { label: 'Comuna 14 – El Poblado', value: 879 },
                { label: 'Comuna 16 – Belén', value: 877 }, { label: 'Comuna 15 – Guayabal', value: 870 },
                { label: 'Comuna 4 – Aranjuez', value: 783 }, { label: 'Comuna 8 – Villa Hermosa', value: 762 },
                { label: 'Comuna 60 – San Cristóbal', value: 615 }, { label: 'Comuna 12 – La América', value: 609 },
                { label: 'Comuna 13 – San Javier', value: 573 }, { label: 'Comuna 6 – Doce de Octubre', value: 543 },
                { label: 'Comuna 1 – Popular', value: 525 }, { label: 'Comuna 2 – Santa Cruz', value: 478 },
                { label: 'Comuna 9 – Buenos Aires', value: 469 }, { label: 'Comuna 80 – San Antonio de Prado', value: 374 },
                { label: 'Comuna 90 – Santa Elena', value: 220 }, { label: 'Comuna 70 – Altavista', value: 137 },
                { label: 'Comuna 50 – San Sebastián de Palmitas', value: 25 }
            ]
        };
        
        function abrirReporte() {
            const select = document.getElementById('comuna-select');
            const comunaId = select.value;
            if (comunaId) {
                window.open(`comuna${comunaId}.html`, '_blank');
            } else {
                alert('Por favor, selecciona una comuna.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            
            function populateContent() {
                // Populate stats but leave counters at 0 initially for animation
                document.getElementById('stat-huecos').textContent = pageData.stats.huecosTapados;
                document.getElementById('stat-material-removido').textContent = pageData.stats.materialRemovido;
                document.getElementById('stat-personas-emergencias').textContent = pageData.stats.personasEmergencias;
                document.getElementById('parques-renovados').textContent = pageData.stats.parquesRenovados;
                document.getElementById('parques-metros-intervenidos').textContent = pageData.stats.parquesMetrosIntervenidos;
                
                // Populate the rest of the content
                document.getElementById('infra-corredores').textContent = pageData.infraVerde.corredores;
                document.getElementById('infra-puentes').textContent = pageData.infraVerde.puentes;
                document.getElementById('infra-metros-verdes').textContent = pageData.infraVerde.metrosVerdes;
                document.getElementById('infra-inversion-vegas').textContent = pageData.infraVerde.inversionVegas;
                document.getElementById('mant-jardineros').textContent = pageData.infraVerde.jardineros;
                document.getElementById('mant-metros-conservacion').textContent = pageData.infraVerde.metrosConservacion;
                document.getElementById('mant-individuos-arboreos').textContent = pageData.infraVerde.individuosArboreos;
                document.getElementById('mant-plantas-sembradas').textContent = pageData.infraVerde.plantasSembradas;
                document.getElementById('mant-inversion-total').textContent = pageData.infraVerde.inversionMantenimiento;
                document.getElementById('p4sur-inversion').textContent = pageData.puente4Sur.inversion;
                document.getElementById('p4sur-plantas').textContent = pageData.puente4Sur.plantas;
                document.getElementById('p4sur-muros').innerHTML = pageData.puente4Sur.muros;
                document.getElementById('p4sur-materas').innerHTML = pageData.puente4Sur.materas;
                document.getElementById('p4sur-pintura').innerHTML = pageData.puente4Sur.pintura;
                document.getElementById('date-p4sur').textContent = pageData.dates.cortePuente4Sur;
                document.getElementById('date-emergencias').textContent = pageData.dates.corteEmergencias;
                
                const parquesLista = document.getElementById('parques-finalizados-lista');
                parquesLista.innerHTML = '';
                pageData.parques.listaFinalizados.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = item;
                    parquesLista.appendChild(li);
                });

                document.getElementById('parques-inversion-futura').textContent = pageData.parques.inversionFutura;
                document.getElementById('parques-futuros-cantidad').textContent = pageData.parques.cantidadFuturos;
                document.getElementById('pui-entregados').textContent = pageData.proyectosEstrategicos.puiEntregados;
                document.getElementById('pui-inversion').textContent = pageData.proyectosEstrategicos.puiInversion;
                document.getElementById('pui-habitantes').textContent = pageData.proyectosEstrategicos.puiHabitantes;
                document.getElementById('pp-puntos').textContent = pageData.proyectosEstrategicos.ppPuntos;
                document.getElementById('pp-avance').textContent = pageData.proyectosEstrategicos.ppAvance;
                document.getElementById('pp-adicion').textContent = pageData.proyectosEstrategicos.ppAdicion;
                document.getElementById('pp-total-frentes').textContent = pageData.proyectosEstrategicos.ppTotalFrentes;
                document.getElementById('o-estab-puntos').textContent = pageData.proyectosEstrategicos.obrasEstabilizacionPuntos;
                document.getElementById('o-estab-intervenidos').textContent = pageData.proyectosEstrategicos.obrasEstabilizacionIntervenidos;
                document.getElementById('o-estab-proyeccion').textContent = pageData.proyectosEstrategicos.obrasEstabilizacionProyeccion;
                document.getElementById('o-estab-inversion').textContent = pageData.proyectosEstrategicos.obrasEstabilizacionInversion;
                document.getElementById('cuadrillas-contrato-objeto').textContent = pageData.gestionEstrategica.cuadrillasContrato;
                document.getElementById('cuadrillas-puntos-atendidos').textContent = pageData.gestionEstrategica.cuadrillasPuntosAtendidos;
                document.getElementById('licit-procesos-activos').textContent = pageData.gestionEstrategica.licitacionesActivas;
                
                const licitLista = document.getElementById('licit-lista-tipos');
                licitLista.innerHTML = '';
                pageData.gestionEstrategica.licitacionesTipos.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    licitLista.appendChild(li);
                });
            }
            populateContent();

            function renderCustomBarChart() {
                const container = document.getElementById('barChartContainer');
                container.innerHTML = ''; 
                const chartData = pageData.barChartData;
                const maxValue = Math.max(...chartData.map(item => item.value));

                chartData.forEach(item => {
                    const widthPercentage = (item.value / maxValue) * 100;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'bar-chart-item';
                    const labelDiv = document.createElement('div');
                    labelDiv.className = 'bar-label';
                    labelDiv.textContent = item.label;
                    const barContainerDiv = document.createElement('div');
                    barContainerDiv.className = 'bar-container';
                    const barDiv = document.createElement('div');
                    barDiv.className = 'bar';
                    barDiv.style.width = '0%'; // Start at 0 for animation
                    // Animate width when the bar chart is visible
                    const chartObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                setTimeout(() => { // Small delay for better visual effect
                                     barDiv.style.width = `${widthPercentage}%`;
                                }, 200);
                                observer.unobserve(entry.target);
                            }
                        });
                    }, { threshold: 0.5 });
                    chartObserver.observe(barContainerDiv);
                    
                    barDiv.textContent = item.value.toLocaleString('es-CO');
                    barContainerDiv.appendChild(barDiv);
                    itemDiv.appendChild(labelDiv);
                    itemDiv.appendChild(barContainerDiv);
                    container.appendChild(itemDiv);
                });
            }
            renderCustomBarChart();

            // Lógica para las pestañas de Gestión Estratégica
            const tabLinks = document.querySelectorAll('.tab-link');
            const tabPanes = document.querySelectorAll('.tab-pane');
            tabLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const targetId = link.getAttribute('data-target');

                    tabLinks.forEach(item => item.classList.remove('active'));
                    tabPanes.forEach(item => item.classList.remove('active'));

                    link.classList.add('active');
                    document.getElementById(targetId).classList.add('active');
                });
            });

            // Lógica para Comunas
            const communeData = [
                { name: 'Comuna 1 – Popular', id: 1 }, { name: 'Comuna 2 – Santa Cruz', id: 2 },
                { name: 'Comuna 3 – Manrique', id: 3 }, { name: 'Comuna 4 – Aranjuez', id: 4 },
                { name: 'Comuna 5 – Castilla', id: 5 }, { name: 'Comuna 6 – Doce de Octubre', id: 6 },
                { name: 'Comuna 7 – Robledo', id: 7 }, { name: 'Comuna 8 – Villa Hermosa', id: 8 },
                { name: 'Comuna 9 – Buenos Aires', id: 9 }, { name: 'Comuna 10 – La Candelaria', id: 10 },
                { name: 'Comuna 11 – Laureles-Estadio', id: 11 }, { name: 'Comuna 12 – La América', id: 12 },
                { name: 'Comuna 13 – San Javier', id: 13 }, { name: 'Comuna 14 – El Poblado', id: 14 },
                { name: 'Comuna 15 – Guayabal', id: 15 }, { name: 'Comuna 16 – Belén', id: 16 },
                { name: 'Comuna 50 – San Sebastián de Palmitas', id: 50 }, { name: 'Comuna 60 – San Cristóbal', id: 60 },
                { name: 'Comuna 70 – Altavista', id: 70 }, { name: 'Comuna 80 – San Antonio de Prado', id: 80 },
                { name: 'Comuna 90 – Santa Elena', id: 90 }
            ];
            const selectComuna = document.getElementById('comuna-select');
            communeData.forEach(commune => {
                const option = document.createElement('option');
                option.value = commune.id;
                option.textContent = commune.name.replace(/–\s/g, '- ');
                selectComuna.appendChild(option);
            });
            
            // --- INICIO DE MEJORAS ---

            // 1. Animación de Contadores
            function animateCounter(el) {
                const originalText = el.textContent.trim();
                const prefix = originalText.match(/^[^\d]*/)[0] || '';
                const suffix = originalText.match(/[^\d.,]*$/)[0] || '';
                const targetNumber = parseInt(originalText.replace(/[^\d]/g, ''), 10);

                if (isNaN(targetNumber)) return;
                
                el.textContent = prefix + '0' + suffix;
                let startTime = null;
                const duration = 1800; // ms

                const step = (timestamp) => {
                    if (!startTime) startTime = timestamp;
                    const progress = Math.min((timestamp - startTime) / duration, 1);
                    const currentVal = Math.floor(progress * targetNumber);
                    el.textContent = prefix + currentVal.toLocaleString('es-CO') + suffix;
                    if (progress < 1) {
                        requestAnimationFrame(step);
                    } else {
                        el.textContent = prefix + targetNumber.toLocaleString('es-CO') + suffix;
                    }
                };
                requestAnimationFrame(step);
            }

            // 2. Observer para animaciones en scroll
            const scrollObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');

                        if (entry.target.classList.contains('stat-box')) {
                            const numberEl = entry.target.querySelector('.stat-number');
                            if (numberEl && !numberEl.dataset.animated) {
                                animateCounter(numberEl);
                                numberEl.dataset.animated = 'true';
                            }
                        }
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2 });

            document.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
            
            // --- FIN DE MEJORAS ---


            // --- Lógica del Asistente Virtual (Sin cambios) ---
            const reportesSIF = {
                planeacion: { name: "Subsecretaría de Planeación", unidades: { gestion_informacion: { name: "Unidad de Gestión de la Información y Proyectos", reports: [ { name: "Ejecución Presupuestal", keywords: ['presupuesto', 'ejecución', 'plata', 'inversión'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNDAyOGE4OTMtZTExMi00M2VlLWJiNmUtMTMwMzk3MjY0YmU3IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Quiero ver cómo se invierte el presupuesto"] }, { name: "Indicadores PI", keywords: ['indicadores', 'pi', 'avance'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMDk4YTEyZTMtY2FlZi00Y2Y0LWI2ODgtNDZiYTgxN2EzZDMyIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo van los indicadores de rendimiento?"] }, { name: "Informe Tácita de plata", keywords: ['tácita', 'plata'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjliYjNkNGQtYjJiMC00MDRhLWJlZDMtYjk4YmI1YjMwZjUzIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Muéstrame el informe de Tácita de Plata"] } ] }, estudios_disenos: { name: "Unidad de Estudios y Diseños", reports: [ { name: "Parques - Tejiendo Hogares", keywords: ['parques', 'tejiendo hogares'], href: 'https://app.powerbi.com/view?r=eyJrIjoiN2Y1ZTQyNGQtOTkzZC00MjY4LTg5NzktZWY1NzNiYjE2NzBkIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver el impacto del proyecto 'Tejiendo Hogares'"] } ] }, gestion_contractual: { name: "Unidad de Gestión Contractual", reports: [ { name: "Proceso Precontractual", keywords: ['precontractual', 'contratos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMzE1MWNmMjQtYWEyMy00MGVjLWI4MjgtNzIzZTYxZDAzNDVhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué proyectos se van a contratar pronto?"] } ] } } },
                construccion: { name: "Subsecretaría de Construcción y Mantenimiento", unidades: { ejecucion_proyectos: { name: "Unidad de ejecución de Proyectos", reports: [ { name: "Seguimiento a contratos de Obra", keywords: ['contratos', 'obra'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNTI2N2NhMjktN2RmOS00OTliLTg1Y2UtMjY2M2Q5MDcxOTY0IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo van las obras en construcción?"] }, { name: "Empleabilidad", keywords: ['empleabilidad', 'empleo'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNjUyOWI4ZmQtZWIzNi00NjM2LTlkOGUtOGM0OTUwNjY1MmNmIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver el impacto en la generación de empleo"] }, { name: "Informe Baches", keywords: ['baches', 'huecos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNWI3ZTNkZmMtMjEyNy00NjU1LTk3YzktNTMyOGJkMzZlN2ZiIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Quiero ver el mapa de reparación de huecos"] }, { name: "Informe Paraderos", keywords: ['paraderos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZDQ2OGM4MDItYTc1Zi00MjE5LWJlNmUtZjJhMDE3ZjkzMWFjIiwidCI6ImJhMzM0NGUyLTAxMGYtNGJkZi1iNTEyLWMzOGRmYTdhNWJhNSIsImMiOjR9', preguntas: ["¿Cómo va la renovación de paraderos?"] } ] }, socioambiental_paisajismo: { name: "Unidad Socioambiental y Paisajismo", reports: [ { name: "Jardín Botánico*", keywords: ['jardín', 'botánico'], href: 'https://app.powerbi.com/view?r=eyJrIjoiOGQwNzU5ODgtNmIyYS00YTQ3LTg3ODMtOGRhOTU2MmMyNjZhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver proyectos con el Jardín Botánico"] }, { name: "Parque Arví*", keywords: ['arví'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMDkyNjU3Y2UtOTRjNy00YjVjLTg0MzgtNzBiYmUyOWNhNzEwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué se está haciendo en el Parque Arví?"] } ] }, mantenimiento: { name: "Unidad de Mantenimiento", reports: [ { name: "Trabajadores Oficiales", keywords: ['trabajadores', 'oficiales'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNWM1NzY3MjQtZmViMy00YmRiLWJiODgtMDg0MDRhZjVkMTgzIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Conocer sobre los trabajadores oficiales"] }, { name: "Solicitudes Baches SIRO", keywords: ['siro', 'solicitudes baches'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNzkzZmIyODUtMGE3YS00YTUwLTkyYTMtMTBlODI3MWE4OWU2IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar el estado de mi solicitud de un bache"] }, { name: "Parque Automotor", keywords: ['automotor', 'vehículos', 'maquinaria'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNmQ1ZThhNWItZTA1Mi00ZDc4LTgwMTktYWEyYzViOTY1YTNhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Explorar el estado del parque automotor"] }, { name: "Intervenciones Directas", keywords: ['intervenciones', 'directas'], href: 'https://app.powerbi.com/view?r=eyJrIjoiYjE2NjE2MjItNTUxNi00ZTI4LThmNzAtNjY0NThjNGYxN2Q2IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver las pequeñas obras en los barrios"] }, { name: "Permisos de Roturas*", keywords: ['roturas', 'permisos'], href: '#link-placeholder', preguntas: ["Entender la gestión de permisos de roturas"] } ] } } },
                despacho: { name: "Despacho SIF", reports: [ { name: "Gerencia de Corregimientos", keywords: ['corregimientos', 'gerencia', 'rural'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZmVhNjY3YTYtNTIwNi00NzUzLTkyYWYtZmZiMDBiNTdkNWQwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué obras hay en los corregimientos?"] }, { name: "Informe Calamidad Pública", keywords: ['calamidad', 'pública', 'emergencias'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjEyMzdhNGEtZGVjNC00YTM4LWEzNDAtMjI1MmY1NzdlODEwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver informe de gestión de emergencias"] }, { name: "Plan de Contratación", keywords: ['plan', 'contratación', 'licitaciones'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjgzYmIxZTctMmM1Yi00YWEzLWIyYTktYjk3ODYxNGI3NTY4IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar el plan anual de adquisiciones"] }, { name: "Informe de Gestión", keywords: ['gestión', 'informe de gestión', 'resumen'], href: '#link-placeholder', preguntas: ["Quiero un resumen de la gestión"] } ] },
                direccion: { name: "Dirección Técnica", reports: [ { name: "Estado proyectos estratégicos", keywords: ['estratégicos', 'proyectos', 'metro 80'], href: 'https://app.powerbi.com/view?r=eyJrIjoiYzEzZGI3ZTUtNDc1ZS00ODdjLTg1YTctYTA1OGZjYzdmMTVlIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo avanzan los proyectos estratégicos?"] } ] },
                apoyo_juridico: { name: "Apoyo Jurídico", reports: [ { name: "Acciones Populares", keywords: ['acciones', 'populares', 'demandas'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZWY3ZDM3ODctMGFmYS00OTlmLWJlYTgtMmViNTE5NmZmYjA5IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar estado de acciones populares"] } ] },
                comunicaciones: { name: "Comunicaciones", reports: [] },
                unidad_administrativa: { name: "Unidad Administrativa", reports: [] }
            };
            const faqData = {
                'huecos': { keywords: ['hueco', 'bache', 'malla vial'], answer: `¡Hemos trabajado sin descanso en la malla vial! A la fecha, la cifra es de <strong>+${pageData.stats.huecosTapados} huecos</strong> tapados en la ciudad y los corregimientos. ¡Seguimos sumando para mejorar tu movilidad! 🚧` },
                'infraVerde': { keywords: ['verde', 'jardines', 'árboles'], answer: `¡Medellín es un jardín! Hemos creado <strong>${pageData.infraVerde.corredores} nuevos corredores verdes y ${pageData.infraVerde.puentes} puentes</strong>, que suman <strong>${pageData.infraVerde.metrosVerdes}</strong> de nuevos espacios para todos. Además, más de <strong>${pageData.infraVerde.jardineros} jardineros</strong> cuidan de ellos. 🌳` },
                'puente4Sur': { keywords: ['4 sur', 'cuatro sur'], answer: `¡El puente de la 4 Sur está más verde que nunca! Invertimos más de <strong>${pageData.puente4Sur.inversion}</strong> en su renovación y sembramos más de <strong>${pageData.puente4Sur.plantas} plantas</strong> para embellecerlo. 🌉` },
                'parques': { keywords: ['parque', 'juegos'], answer: `¡Claro que sí! Hemos renovado <strong>${pageData.stats.parquesRenovados} parques</strong> y espacios públicos. Y la buena noticia es que viene una inversión de más de <strong>${pageData.parques.inversionFutura}</strong> para mejorar y construir otros <strong>${pageData.parques.cantidadFuturos} parques</strong>. ¡Más lugares para disfrutar! 🏞️` },
                'pui': { keywords: ['pui', 'proyectos urbanos'], answer: `Los Proyectos Urbanos Integrales (PUI) transforman barrios enteros. Ya entregamos <strong>${pageData.proyectosEstrategicos.puiEntregados}</strong> con una inversión de <strong>${pageData.proyectosEstrategicos.puiInversion}</strong>, beneficiando a más de <strong>${pageData.proyectosEstrategicos.puiHabitantes} personas</strong>. 💪` },
                'cuadrillas': { keywords: ['cuadrillas', 'alcalde'], answer: `Las Cuadrillas del Alcalde son nuestros equipos de respuesta rápida. Con un contrato de <strong>${pageData.gestionEstrategica.cuadrillasContrato.split(" ")[4]}</strong>, ya han atendido <strong>${pageData.gestionEstrategica.cuadrillasPuntosAtendidos}</strong> de la ciudad para reparaciones y mantenimiento. 👷‍♂️` },
                'licitacion': { keywords: ['licitación', 'licitaciones', 'contratación'], answer: `Para garantizar que las obras no paren, actualmente tenemos <strong>${pageData.gestionEstrategica.licitacionesActivas}</strong> abiertos para malla vial, parques, andenes y mucho más. ¡El futuro de Medellín se sigue construyendo! 🏗️` }
            };
            const fab = document.getElementById('chat-fab');
            const chatWindow = document.getElementById('chat-window');
            const closeBtn = document.getElementById('chat-close-btn');
            
            const ui = {
                chatMessages: document.getElementById('chat-messages-container'),
                chatInput: document.getElementById('chat-input'),
                sendBtn: document.getElementById('send-btn'),
                optionsGrid: document.getElementById('options-grid'),
                breadcrumbContainer: document.getElementById('breadcrumb-container'),
                backBtn: document.getElementById('back-btn'),
            };
            
            let botTyping = false;
            let navigationPath = [];
            function addMessage(content, sender, options = {}) {
                const bubble = document.createElement('div');
                bubble.className = `max-w-xs md:max-w-lg p-3 rounded-xl ${sender === 'user' ? 'chat-bubble-user self-end' : 'chat-bubble-bot self-start'}`;
                bubble.innerHTML = options.isHtml ? content : content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                ui.chatMessages.appendChild(bubble);
                ui.chatMessages.scrollTop = ui.chatMessages.scrollHeight;
            }
            function addBotMessage(text, options = {}) {
                if (botTyping) return;
                botTyping = true;
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'chat-bubble-bot self-start p-3 rounded-xl flex items-center space-x-2';
                typingIndicator.innerHTML = `<span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0s;"></span><span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span><span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.4s;"></span>`;
                ui.chatMessages.appendChild(typingIndicator);
                ui.chatMessages.scrollTop = ui.chatMessages.scrollHeight;
                setTimeout(() => {
                    if (typingIndicator.parentNode) {
                        ui.chatMessages.removeChild(typingIndicator);
                    }
                    addMessage(text, 'bot', options);
                    botTyping = false;
                }, 800 + Math.random() * 400);
            }
            function getCurrentLevelObject() {
                let level = reportesSIF;
                for (const key of navigationPath) {
                    level = level[key];
                    if (level && level.unidades) {
                        level = level.unidades;
                    }
                }
                return level;
            }
            function displayOptions() {
                const currentLevel = getCurrentLevelObject();
                ui.optionsGrid.innerHTML = '';
                ui.backBtn.classList.toggle('hidden', navigationPath.length === 0);
                updateBreadcrumbs();
                if (Array.isArray(currentLevel)) {
                    if (currentLevel.length === 0) addBotMessage('Aquí no hay más informes, ¡pero puedes volver y explorar otra sección! 😉');
                    currentLevel.forEach(report => {
                        const randomQuestion = report.preguntas[Math.floor(Math.random() * report.preguntas.length)];
                        createButton(randomQuestion, 'report', { href: report.href, reportName: report.name });
                    });
                } else { 
                    if (Object.keys(currentLevel).length === 0) addBotMessage('Parece que esta sección está vacía. ¡Intenta en otro lugar!');
                    for (const [key, value] of Object.entries(currentLevel)) {
                        createButton(value.name, 'dependency', { navKey: key });
                    }
                }
            }
            function createButton(name, type, data) {
                const button = document.createElement('button');
                button.className = 'option-btn bg-white text-slate-700 text-sm font-medium p-3 rounded-lg hover:bg-slate-50 text-left';
                button.innerHTML = `<span class="font-bold">${name}</span>`;
                button.dataset.type = type;
                for (const [key, value] of Object.entries(data)) {
                    button.dataset[key] = value;
                }
                ui.optionsGrid.appendChild(button);
            }
            function updateBreadcrumbs() {
                if (navigationPath.length === 0) {
                    ui.breadcrumbContainer.innerHTML = 'Inicio';
                    return;
                }
                let pathText = `<a href="#" class="hover:underline" data-level="-1">Inicio</a>`;
                let level = reportesSIF;
                navigationPath.forEach((key) => {
                    level = level[key];
                    pathText += ` / ${level.name}`;
                    if (level.unidades) level = level.unidades;
                });
                ui.breadcrumbContainer.innerHTML = pathText;
            }
            function searchAllReports(obj) {
                let reports = [];
                for (const key in obj) {
                    if (key === 'reports') {
                        reports = reports.concat(obj[key]);
                    } else if (typeof obj[key] === 'object' && obj[key] !== null) {
                        reports = reports.concat(searchAllReports(obj[key]));
                    }
                }
                return reports;
            }
            function handleUserInput() {
                const userInput = ui.chatInput.value.trim();
                if (userInput === '' || botTyping) return;
                addMessage(userInput, 'user');
                ui.chatInput.value = '';
                generateBotResponse(userInput);
            }
            function generateBotResponse(input) {
                const lowerInput = input.toLowerCase();
                const allReports = searchAllReports(reportesSIF);
                const foundReport = allReports.find(report => 
                    report.name.toLowerCase().includes(lowerInput) || 
                    report.keywords.some(kw => lowerInput.includes(kw))
                );
                if (foundReport) {
                    const message = `¡Excelente! Encontré justo lo que buscas. Aquí tienes el acceso directo al informe sobre <strong class="font-semibold">${foundReport.name}</strong>. ¡Espero que los datos te sean de mucha utilidad! <br><br><a href="${foundReport.href}" target="_blank" class="text-blue-600 font-bold hover:underline" onclick="reportOpened()">🚀 Abrir Tablero de Power BI</a>`;
                    addBotMessage(message, { isHtml: true });
                    return;
                }
                for (const key in faqData) {
                    if (faqData[key].keywords.some(kw => lowerInput.includes(kw))) {
                        addBotMessage(faqData[key].answer, { isHtml: true });
                        return;
                    }
                }
                const notFoundMessage = "Vaya, parece que no encontré nada con esas palabras exactas. 🤔 No te preocupes, a veces los términos técnicos pueden ser confusos. ¿Qué tal si intentas con una palabra más general como 'contratos', 'inversión' o 'parques'? O si prefieres, sigue explorando las opciones de abajo.";
                addBotMessage(notFoundMessage, { isHtml: true });
            }
            window.reportOpened = () => {
                addBotMessage("¡Perfecto! Abriendo el informe en una nueva pestaña. Si necesitas algo más, no dudes en preguntar. 😊");
            };
            fab.addEventListener('click', () => {
                chatWindow.classList.toggle('visible');
                if (chatWindow.classList.contains('visible') && ui.chatMessages.children.length === 0) {
                     addBotMessage("¡Hola! Soy SIF, tu asistente virtual de la Secretaría de Infraestructura. 😊 Estoy aquí para ayudarte a navegar por todos nuestros datos y proyectos. ¿Qué información te interesa hoy? Puedes explorar las categorías de abajo o preguntarme directamente por algo como 'huecos tapados' o 'nuevos parques'.");
                     displayOptions();
                }
            });
            closeBtn.addEventListener('click', () => chatWindow.classList.remove('visible'));
            ui.sendBtn.addEventListener('click', handleUserInput);
            ui.chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserInput(); });
            ui.optionsGrid.addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn');
                if (!button) return;
                const { type, navKey, href, reportName } = button.dataset;
                if (type === 'dependency') {
                    navigationPath.push(navKey);
                    const nextLevel = getCurrentLevelObject();
                    if (nextLevel && nextLevel.reports) { 
                        navigationPath.push('reports');
                    }
                    displayOptions();
                } else if (type === 'report') {
                    const message = `¡Perfecto! Aquí tienes el acceso al informe: <br><strong class="font-semibold">${reportName}</strong>. <br><br><a href="${href}" target="_blank" class="text-blue-600 font-bold hover:underline" onclick="reportOpened()">🚀 Abrir Tablero de Power BI</a>`;
                    addBotMessage(message, { isHtml: true });
                }
            });
            ui.backBtn.addEventListener('click', () => {
                if (navigationPath.length > 0) {
                    if (navigationPath[navigationPath.length - 1] === 'reports') {
                        navigationPath.pop();
                    }
                    navigationPath.pop();
                    displayOptions();
                }
            });
            ui.breadcrumbContainer.addEventListener('click', (e) => {
                e.preventDefault();
                const link = e.target.closest('a');
                if (link && link.dataset.level === "-1") {
                    navigationPath = [];
                    displayOptions();
                }
            });
        });
    </script>
</body>
</html>