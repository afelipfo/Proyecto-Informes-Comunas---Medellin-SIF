<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Consulta Ciudadana - Infraestructura Medellín</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary-color: #0d47a1;
            --primary-color-dark: #003D6B;
            --secondary-color: #f57c00;
            --text-color: #212121;
            --text-color-light: #555;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --light-gray: #e9ecef;
        }
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-color-dark));
            color: white;
            text-align: center;
            padding: 40px 20px 50px 20px;
            border-bottom: 5px solid var(--secondary-color);
        }
        .header-logo {
            max-width: 280px;
            margin-bottom: 25px;
            animation: fadeInDown 1s ease-in-out;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 900;
            line-height: 1.2;
            animation: fadeInUp 1s ease-in-out;
        }
        header p.subheading {
            font-size: 1.2em;
            margin: 10px 0 0 0;
            font-weight: 300;
            opacity: 0.9;
            animation: fadeInUp 1s ease-in-out 0.2s;
            animation-fill-mode: backwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        main > .intro-text {
            font-size: 1.15em;
            text-align: center;
            color: var(--text-color-light);
            max-width: 800px;
            margin: 40px auto -20px auto;
            line-height: 1.6;
        }

        section {
            padding: 60px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        main > section:last-of-type {
            border-bottom: none;
        }
        .card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .consulta-comuna-container {
             display: flex;
             flex-direction: column;
             gap: 20px;
             padding: 30px;
             box-sizing: border-box;
        }
        
        .consulta-comuna-container h3 {
             font-size: 1.5em;
             margin-top: 0;
             margin-bottom: 5px;
             color: var(--primary-color);
             font-weight: 700;
        }
        .consulta-comuna-container p {
            font-size: 1em;
            color: var(--text-color-light);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .consulta-comuna-container label {
            font-size: 1em;
            font-weight: 600;
            color: var(--text-color);
            display: block;
            margin-bottom: 10px;
        }
        .consulta-comuna-container select {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 1px solid #ced4da;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            background-color: var(--bg-color);
        }
        .consulta-comuna-container button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .consulta-comuna-container button:hover {
            background-color: #e66300;
        }

        #indicadores-cta {
            background-color: var(--light-gray);
            text-align: center;
            padding: 50px 20px;
            border-radius: 10px;
        }
        #indicadores-cta h2 {
            font-size: 2.2em;
            color: var(--primary-color-dark);
            font-weight: 700;
        }
        #indicadores-cta p {
            font-size: 1.1em;
            max-width: 650px;
            margin: -10px auto 30px auto;
            color: var(--text-color-light);
            line-height: 1.6;
        }
        .cta-button {
            display: inline-block;
            background: linear-gradient(45deg, var(--secondary-color), #ff8f00);
            color: white;
            text-decoration: none;
            padding: 18px 40px;
            font-size: 1.2em;
            font-weight: 700;
            border-radius: 50px;
            box-shadow: 0 8px 20px rgba(245, 124, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(245, 124, 0, 0.4);
        }
        .cta-button .fa-solid {
            margin-right: 10px;
            font-size: 1em;
        }
        
        #chat-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1001;
            transition: transform 0.3s;
        }
        #chat-fab:hover {
            transform: scale(1.1);
        }
        #chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 420px;
            max-width: 90vw;
            height: 80vh;
            max-height: 700px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1002;
            transform: scale(0.5);
            transform-origin: bottom right;
            opacity: 0;
            pointer-events: none;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #chat-window.visible {
            transform: scale(1);
            opacity: 1;
            pointer-events: auto;
        }
        .chat-header {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        #chat-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        
        .chat-body {
            font-family: 'Inter', sans-serif;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background-color: #f0f4f8;
            height: 100%;
            overflow: hidden;
        }
        .chat-bubble-user { background-color: #2563EB; color: white; }
        .chat-bubble-bot { background-color: #E2E8F0; color: #1E293B; }
        #chat-messages-container::-webkit-scrollbar { width: 6px; }
        #chat-messages-container::-webkit-scrollbar-track { background: #CBD5E1; }
        #chat-messages-container::-webkit-scrollbar-thumb { background: #94A3B8; border-radius: 3px; }
        #chat-messages-container::-webkit-scrollbar-thumb:hover { background: #64748B; }
        .option-btn {
            transition: all 0.2s ease-in-out;
            border: 1px solid #CBD5E1;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #3B82F6;
        }

        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            will-change: opacity, transform;
        }
        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>

    <header>
        <img src="logo_footer.png" alt="Logo Alcaldía de Medellín" class="header-logo">
        <h1>Portal de Consulta Ciudadana</h1>
        <p class="subheading">Secretaría de Infraestructura Física | Gestión 2025</p>
    </header>
    
    <main class="container">

        <p class="intro-text">
            ¡Te damos la bienvenida! Este es un espacio de transparencia creado para ti. Aquí podrás consultar el detalle de las obras en tu comuna y explorar los indicadores de gestión de nuestros proyectos estratégicos.
        </p>

        <section id="consulta-comuna">
            <div class="card reveal-on-scroll" style="padding: 0; overflow: hidden;">
                <div class="consulta-comuna-container">
                    <h3><i class="fa-solid fa-map-location-dot"></i> Explora las Obras en tu Comuna</h3>
                    <p>Queremos que estés informado. Selecciona tu comuna o corregimiento para ver en detalle las intervenciones y proyectos que estamos realizando en tu sector.</p>
                    <div>
                        <label for="comuna-select"><strong>Selecciona tu comuna o corregimiento:</strong></label>
                        <select id="comuna-select">
                            <option value="" disabled selected>-- Escoge una opción --</option>
                        </select>
                    </div>
                    <button onclick="abrirReporte()">
                        <i class="fa-solid fa-magnifying-glass"></i> Consultar Obras
                    </button>
                </div>
            </div>
        </section>

        <section id="indicadores-cta" class="reveal-on-scroll">
            <h2><i class="fa-solid fa-chart-line"></i> Indicadores de Gestión SIF</h2>
            <p>Los datos son clave para la transparencia. Accede a nuestro tablero de control interactivo y sigue en tiempo real el avance de los proyectos que transforman a Medellín.</p>
            <a href="indicadores.html" class="cta-button" target="_blank" rel="noopener noreferrer">
                <i class="fa-solid fa-arrow-up-right-from-square"></i> Ver Tablero Interactivo
            </a>
        </section>

    </main>
    
    <div id="chat-fab">
        <i class="fa-solid fa-robot"></i>
    </div>
    
    <div id="chat-window">
        <div class="chat-header">
            <span>Asistente Virtual SIF</span>
            <button id="chat-close-btn">✖</button>
        </div>
        <div class="chat-body">
            <div id="chat-messages-container" class="flex-grow p-4 overflow-y-auto space-y-4">
            </div>
            
            <div id="options-container" class="p-3 border-t bg-slate-50 space-y-3">
                <div id="navigation-controls" class="flex justify-between items-center text-sm mb-2">
                    <button id="back-btn" class="text-blue-600 hover:underline hidden">← Volver</button>
                    <div id="breadcrumb-container" class="text-slate-500 text-right font-medium"></div>
                </div>
                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                </div>
            </div>

            <div class="p-4 border-t bg-white rounded-b-xl">
                <div class="flex items-center space-x-2">
                    <input type="text" id="chat-input" placeholder="Pregúntame algo, como 'huecos' o 'parques'..." class="flex-grow border rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="send-btn" class="bg-blue-500 text-white rounded-full p-3 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // DATOS AUN DISPONIBLES PARA EL CHATBOT
        const pageData = {
            stats: {
                huecosTapados: "13,822",
                materialRemovido: "60,000 m³",
                personasEmergencias: "300",
                parquesRenovados: "17",
                parquesMetrosIntervenidos: "11,890 m²"
            },
            infraVerde: {
                corredores: 3,
                puentes: 3,
                metrosVerdes: "5,000 m²",
                jardineros: "540"
            },
            puente4Sur: {
                inversion: "$1.330 millones",
                plantas: "4.300"
            },
            parques: {
                inversionFutura: "$20.000 millones",
                cantidadFuturos: 29
            },
            proyectosEstrategicos: {
                puiEntregados: "4 PUI",
                puiInversion: "$16.000 millones",
                puiHabitantes: "209.000"
            },
            gestionEstrategica: {
                cuadrillasContrato: "Contrato Interadministrativo de $23.900 Millones para Atender Contingencias en el Espacio Público.",
                cuadrillasPuntosAtendidos: "152 puntos",
                licitacionesActivas: "12 procesos de licitación"
            }
        };
        
        function abrirReporte() {
            const select = document.getElementById('comuna-select');
            const comunaId = select.value;
            if (comunaId) {
                window.open(`comuna${comunaId}.html`, '_blank');
            } else {
                alert('Por favor, selecciona una comuna.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            
            // Lógica para Comunas
            const communeData = [
                { name: 'Comuna 1 – Popular', id: 1 }, { name: 'Comuna 2 – Santa Cruz', id: 2 },
                { name: 'Comuna 3 – Manrique', id: 3 }, { name: 'Comuna 4 – Aranjuez', id: 4 },
                { name: 'Comuna 5 – Castilla', id: 5 }, { name: 'Comuna 6 – Doce de Octubre', id: 6 },
                { name: 'Comuna 7 – Robledo', id: 7 }, { name: 'Comuna 8 – Villa Hermosa', id: 8 },
                { name: 'Comuna 9 – Buenos Aires', id: 9 }, { name: 'Comuna 10 – La Candelaria', id: 10 },
                { name: 'Comuna 11 – Laureles-Estadio', id: 11 }, { name: 'Comuna 12 – La América', id: 12 },
                { name: 'Comuna 13 – San Javier', id: 13 }, { name: 'Comuna 14 – El Poblado', id: 14 },
                { name: 'Comuna 15 – Guayabal', id: 15 }, { name: 'Comuna 16 – Belen', id: 16 },
                { name: 'Comuna 50 – San Sebastián de Palmitas', id: 50 }, { name: 'Comuna 60 – San Cristóbal', id: 60 },
                { name: 'Comuna 70 – Altavista', id: 70 }, { name: 'Comuna 80 – San Antonio de Prado', id: 80 },
                { name: 'Comuna 90 – Santa Elena', id: 90 }
            ];
            const selectComuna = document.getElementById('comuna-select');
            communeData.forEach(commune => {
                const option = document.createElement('option');
                option.value = commune.id;
                option.textContent = commune.name.replace(/–\s/g, '- ');
                selectComuna.appendChild(option);
            });
            
            // Observer para animaciones en scroll
            const scrollObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2 });

            document.querySelectorAll('.reveal-on-scroll').forEach(el => scrollObserver.observe(el));
            
            // --- Lógica del Asistente Virtual ---
            const reportesSIF = {
                planeacion: { name: "Subsecretaría de Planeación", unidades: { gestion_informacion: { name: "Unidad de Gestión de la Información y Proyectos", reports: [ { name: "Ejecución Presupuestal", keywords: ['presupuesto', 'ejecución', 'plata', 'inversión'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNDAyOGE4OTMtZTExMi00M2VlLWJiNmUtMTMwMzk3MjY0YmU3IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Quiero ver cómo se invierte el presupuesto"] }, { name: "Indicadores PI", keywords: ['indicadores', 'pi', 'avance'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMDk4YTEyZTMtY2FlZi00Y2Y0LWI2ODgtNDZiYTgxN2EzZDMyIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo van los indicadores de rendimiento?"] }, { name: "Informe Tácita de plata", keywords: ['tácita', 'plata'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjliYjNkNGQtYjJiMC00MDRhLWJlZDMtYjk4YmI1YjMwZjUzIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Muéstrame el informe de Tácita de Plata"] } ] }, estudios_disenos: { name: "Unidad de Estudios y Diseños", reports: [ { name: "Parques - Tejiendo Hogares", keywords: ['parques', 'tejiendo hogares'], href: 'https://app.powerbi.com/view?r=eyJrIjoiN2Y1ZTQyNGQtOTkzZC00MjY4LTg5NzktZWY1NzNiYjE2NzBkIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver el impacto del proyecto 'Tejiendo Hogares'"] } ] }, gestion_contractual: { name: "Unidad de Gestión Contractual", reports: [ { name: "Proceso Precontractual", keywords: ['precontractual', 'contratos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMzE1MWNmMjQtYWEyMy00MGVjLWI4MjgtNzIzZTYxZDAzNDVhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué proyectos se van a contratar pronto?"] } ] } } },
                construccion: { name: "Subsecretaría de Construcción y Mantenimiento", unidades: { ejecucion_proyectos: { name: "Unidad de ejecución de Proyectos", reports: [ { name: "Seguimiento a contratos de Obra", keywords: ['contratos', 'obra'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNTI2N2NhMjktN2RmOS00OTliLTg1Y2UtMjY2M2Q5MDcxOTY0IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo van las obras en construcción?"] }, { name: "Empleabilidad", keywords: ['empleabilidad', 'empleo'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNjUyOWI4ZmQtZWIzNi00NjM2LTlkOGUtOGM0OTUwNjY1MmNmIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver el impacto en la generación de empleo"] }, { name: "Informe Baches", keywords: ['baches', 'huecos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNWI3ZTNkZmMtMjEyNy00NjU1LTk3YzktNTMyOGJkMzZlN2ZiIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Quiero ver el mapa de reparación de huecos"] }, { name: "Informe Paraderos", keywords: ['paraderos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZDQ2OGM4MDItYTc1Zi00MjE5LWJlNmUtZjJhMDE3ZjkzMWFjIiwidCI6ImJhMzM0NGUyLTAxMGYtNGJkZi1iNTEyLWMzOGRmYTdhNWJhNSIsImMiOjR9', preguntas: ["¿Cómo va la renovación de paraderos?"] } ] }, socioambiental_paisajismo: { name: "Unidad Socioambiental y Paisajismo", reports: [ { name: "Jardín Botánico*", keywords: ['jardín', 'botánico'], href: 'https://app.powerbi.com/view?r=eyJrIjoiOGQwNzU5ODgtNmIyYS00YTQ3LTg3ODMtOGRhOTU2MmMyNjZhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver proyectos con el Jardín Botánico"] }, { name: "Parque Arví*", keywords: ['arví'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMDkyNjU3Y2UtOTRjNy00YjVjLTg0MzgtNzBiYmUyOWNhNzEwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué se está haciendo en el Parque Arví?"] } ] }, mantenimiento: { name: "Unidad de Mantenimiento", reports: [ { name: "Trabajadores Oficiales", keywords: ['trabajadores', 'oficiales'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNWM1NzY3MjQtZmViMy00YmRiLWJiODgtMDg0MDRhZjVkMTgzIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Conocer sobre los trabajadores oficiales"] }, { name: "Solicitudes Baches SIRO", keywords: ['siro', 'solicitudes baches'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNzkzZmIyODUtMGE3YS00YTUwLTkyYTMtMTBlODI3MWE4OWU2IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar el estado de mi solicitud de un bache"] }, { name: "Parque Automotor", keywords: ['automotor', 'vehículos', 'maquinaria'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNmQ1ZThhNWItZTA1Mi00ZDc4LTgwMTktYWEyYzViOTY1YTNhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Explorar el estado del parque automotor"] }, { name: "Intervenciones Directas", keywords: ['intervenciones', 'directas'], href: 'https://app.powerbi.com/view?r=eyJrIjoiYjE2NjE2MjItNTUxNi00ZTI4LThmNzAtNjY0NThjNGYxN2Q2IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver las pequeñas obras en los barrios"] }, { name: "Permisos de Roturas*", keywords: ['roturas', 'permisos'], href: '#link-placeholder', preguntas: ["Entender la gestión de permisos de roturas"] } ] } } },
                despacho: { name: "Despacho SIF", reports: [ { name: "Gerencia de Corregimientos", keywords: ['corregimientos', 'gerencia', 'rural'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZmVhNjY3YTYtNTIwNi00NzUzLTkyYWYtZmZiMDBiNTdkNWQwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué obras hay en los corregimientos?"] }, { name: "Informe Calamidad Pública", keywords: ['calamidad', 'pública', 'emergencias'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjEyMzdhNGEtZGVjNC00YTM4LWEzNDAtMjI1MmY1NzdlODEwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver informe de gestión de emergencias"] }, { name: "Plan de Contratación", keywords: ['plan', 'contratación', 'licitaciones'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjgzYmIxZTctMmM1Yi00YWEzLWIyYTktYjk3ODYxNGI3NTY4IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar el plan anual de adquisiciones"] }, { name: "Informe de Gestión", keywords: ['gestión', 'informe de gestión', 'resumen'], href: '#link-placeholder', preguntas: ["Quiero un resumen de la gestión"] } ] },
                direccion: { name: "Dirección Técnica", reports: [ { name: "Estado proyectos estratégicos", keywords: ['estratégicos', 'proyectos', 'metro 80'], href: 'https://app.powerbi.com/view?r=eyJrIjoiYzEzZGI3ZTUtNDc1ZS00ODdjLTg1YTctYTA1OGZjYzdmMTVlIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo avanzan los proyectos estratégicos?"] } ] },
                apoyo_juridico: { name: "Apoyo Jurídico", reports: [ { name: "Acciones Populares", keywords: ['acciones', 'populares', 'demandas'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZWY3ZDM3ODctMGFmYS00OTlmLWJlYTgtMmViNTE5NmZmYjA5IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar estado de acciones populares"] } ] },
                comunicaciones: { name: "Comunicaciones", reports: [] },
                unidad_administrativa: { name: "Unidad Administrativa", reports: [] }
            };
            const faqData = {
                'huecos': { keywords: ['hueco', 'bache', 'malla vial'], answer: `¡Hemos trabajado sin descanso en la malla vial! A la fecha, la cifra es de <strong>+${pageData.stats.huecosTapados} huecos</strong> tapados en la ciudad y los corregimientos. ¡Seguimos sumando para mejorar tu movilidad! 🚧` },
                'infraVerde': { keywords: ['verde', 'jardines', 'árboles'], answer: `¡Medellín es un jardín! Hemos creado <strong>${pageData.infraVerde.corredores} nuevos corredores verdes y ${pageData.infraVerde.puentes} puentes</strong>, que suman <strong>${pageData.infraVerde.metrosVerdes}</strong> de nuevos espacios para todos. Además, más de <strong>${pageData.infraVerde.jardineros} jardineros</strong> cuidan de ellos. 🌳` },
                'puente4Sur': { keywords: ['4 sur', 'cuatro sur'], answer: `¡El puente de la 4 Sur está más verde que nunca! Invertimos más de <strong>${pageData.puente4Sur.inversion}</strong> en su renovación y sembramos más de <strong>${pageData.puente4Sur.plantas} plantas</strong> para embellecerlo. 🌉` },
                'parques': { keywords: ['parque', 'juegos'], answer: `¡Claro que sí! Hemos renovado <strong>${pageData.stats.parquesRenovados} parques</strong> y espacios públicos. Y la buena noticia es que viene una inversión de más de <strong>${pageData.parques.inversionFutura}</strong> para mejorar y construir otros <strong>${pageData.parques.cantidadFuturos} parques</strong>. ¡Más lugares para disfrutar! 🏞️` },
                'pui': { keywords: ['pui', 'proyectos urbanos'], answer: `Los Proyectos Urbanos Integrales (PUI) transforman barrios enteros. Ya entregamos <strong>${pageData.proyectosEstrategicos.puiEntregados}</strong> con una inversión de <strong>${pageData.proyectosEstrategicos.puiInversion}</strong>, beneficiando a más de <strong>${pageData.proyectosEstrategicos.puiHabitantes} personas</strong>. 💪` },
                'cuadrillas': { keywords: ['cuadrillas', 'alcalde'], answer: `Las Cuadrillas del Alcalde son nuestros equipos de respuesta rápida. Con un contrato de <strong>${pageData.gestionEstrategica.cuadrillasContrato.split(" ")[4]}</strong>, ya han atendido <strong>${pageData.gestionEstrategica.cuadrillasPuntosAtendidos}</strong> de la ciudad para reparaciones y mantenimiento. 👷‍♂️` },
                'licitacion': { keywords: ['licitación', 'licitaciones', 'contratación'], answer: `Para garantizar que las obras no paren, actualmente tenemos <strong>${pageData.gestionEstrategica.licitacionesActivas}</strong> abiertos para malla vial, parques, andenes y mucho más. ¡El futuro de Medellín se sigue construyendo! 🏗️` }
            };
            const fab = document.getElementById('chat-fab');
            const chatWindow = document.getElementById('chat-window');
            const closeBtn = document.getElementById('chat-close-btn');
            
            const ui = {
                chatMessages: document.getElementById('chat-messages-container'),
                chatInput: document.getElementById('chat-input'),
                sendBtn: document.getElementById('send-btn'),
                optionsGrid: document.getElementById('options-grid'),
                breadcrumbContainer: document.getElementById('breadcrumb-container'),
                backBtn: document.getElementById('back-btn'),
            };
            
            let botTyping = false;
            let navigationPath = [];
            function addMessage(content, sender, options = {}) {
                const bubble = document.createElement('div');
                bubble.className = `max-w-xs md:max-w-lg p-3 rounded-xl ${sender === 'user' ? 'chat-bubble-user self-end' : 'chat-bubble-bot self-start'}`;
                bubble.innerHTML = options.isHtml ? content : content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                ui.chatMessages.appendChild(bubble);
                ui.chatMessages.scrollTop = ui.chatMessages.scrollHeight;
            }
            function addBotMessage(text, options = {}) {
                if (botTyping) return;
                botTyping = true;
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'chat-bubble-bot self-start p-3 rounded-xl flex items-center space-x-2';
                typingIndicator.innerHTML = `<span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0s;"></span><span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span><span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.4s;"></span>`;
                ui.chatMessages.appendChild(typingIndicator);
                ui.chatMessages.scrollTop = ui.chatMessages.scrollHeight;
                setTimeout(() => {
                    if (typingIndicator.parentNode) {
                        ui.chatMessages.removeChild(typingIndicator);
                    }
                    addMessage(text, 'bot', options);
                    botTyping = false;
                }, 800 + Math.random() * 400);
            }
            function getCurrentLevelObject() {
                let level = reportesSIF;
                for (const key of navigationPath) {
                    level = level[key];
                    if (level && level.unidades) {
                        level = level.unidades;
                    }
                }
                return level;
            }
            function displayOptions() {
                const currentLevel = getCurrentLevelObject();
                ui.optionsGrid.innerHTML = '';
                ui.backBtn.classList.toggle('hidden', navigationPath.length === 0);
                updateBreadcrumbs();
                if (Array.isArray(currentLevel)) {
                    if (currentLevel.length === 0) addBotMessage('Aquí no hay más informes, ¡pero puedes volver y explorar otra sección! 😉');
                    currentLevel.forEach(report => {
                        const randomQuestion = report.preguntas[Math.floor(Math.random() * report.preguntas.length)];
                        createButton(randomQuestion, 'report', { href: report.href, reportName: report.name });
                    });
                } else { 
                    if (Object.keys(currentLevel).length === 0) addBotMessage('Parece que esta sección está vacía. ¡Intenta en otro lugar!');
                    for (const [key, value] of Object.entries(currentLevel)) {
                        createButton(value.name, 'dependency', { navKey: key });
                    }
                }
            }
            function createButton(name, type, data) {
                const button = document.createElement('button');
                button.className = 'option-btn bg-white text-slate-700 text-sm font-medium p-3 rounded-lg hover:bg-slate-50 text-left';
                button.innerHTML = `<span class="font-bold">${name}</span>`;
                button.dataset.type = type;
                for (const [key, value] of Object.entries(data)) {
                    button.dataset[key] = value;
                }
                ui.optionsGrid.appendChild(button);
            }
            function updateBreadcrumbs() {
                if (navigationPath.length === 0) {
                    ui.breadcrumbContainer.innerHTML = 'Inicio';
                    return;
                }
                let pathText = `<a href="#" class="hover:underline" data-level="-1">Inicio</a>`;
                let level = reportesSIF;
                navigationPath.forEach((key) => {
                    level = level[key];
                    pathText += ` / ${level.name}`;
                    if (level.unidades) level = level.unidades;
                });
                ui.breadcrumbContainer.innerHTML = pathText;
            }
            function searchAllReports(obj) {
                let reports = [];
                for (const key in obj) {
                    if (key === 'reports') {
                        reports = reports.concat(obj[key]);
                    } else if (typeof obj[key] === 'object' && obj[key] !== null) {
                        reports = reports.concat(searchAllReports(obj[key]));
                    }
                }
                return reports;
            }
            function handleUserInput() {
                const userInput = ui.chatInput.value.trim();
                if (userInput === '' || botTyping) return;
                addMessage(userInput, 'user');
                ui.chatInput.value = '';
                generateBotResponse(userInput);
            }
            function generateBotResponse(input) {
                const lowerInput = input.toLowerCase();
                const allReports = searchAllReports(reportesSIF);
                const foundReport = allReports.find(report => 
                    report.name.toLowerCase().includes(lowerInput) || 
                    report.keywords.some(kw => lowerInput.includes(kw))
                );
                if (foundReport) {
                    const message = `¡Excelente! Encontré justo lo que buscas. Aquí tienes el acceso directo al informe sobre <strong class="font-semibold">${foundReport.name}</strong>. ¡Espero que los datos te sean de mucha utilidad! <br><br><a href="${foundReport.href}" target="_blank" class="text-blue-600 font-bold hover:underline" onclick="reportOpened()">🚀 Abrir Tablero de Power BI</a>`;
                    addBotMessage(message, { isHtml: true });
                    return;
                }
                for (const key in faqData) {
                    if (faqData[key].keywords.some(kw => lowerInput.includes(kw))) {
                        addBotMessage(faqData[key].answer, { isHtml: true });
                        return;
                    }
                }
                const notFoundMessage = "Vaya, parece que no encontré nada con esas palabras exactas. 🤔 No te preocupes, a veces los términos técnicos pueden ser confusos. ¿Qué tal si intentas con una palabra más general como 'contratos', 'inversión' o 'parques'? O si prefieres, sigue explorando las opciones de abajo.";
                addBotMessage(notFoundMessage, { isHtml: true });
            }
            window.reportOpened = () => {
                addBotMessage("¡Perfecto! Abriendo el informe en una nueva pestaña. Si necesitas algo más, no dudes en preguntar. 😊");
            };
            fab.addEventListener('click', () => {
                chatWindow.classList.toggle('visible');
                if (chatWindow.classList.contains('visible') && ui.chatMessages.children.length === 0) {
                     addBotMessage("¡Hola! Soy SIF, tu asistente virtual de la Secretaría de Infraestructura. 😊 Estoy aquí para ayudarte a navegar por todos nuestros datos y proyectos. ¿Qué información te interesa hoy? Puedes explorar las categorías de abajo o preguntarme directamente por algo como 'huecos tapados' o 'nuevos parques'.");
                     displayOptions();
                }
            });
            closeBtn.addEventListener('click', () => chatWindow.classList.remove('visible'));
            ui.sendBtn.addEventListener('click', handleUserInput);
            ui.chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserInput(); });
            ui.optionsGrid.addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn');
                if (!button) return;
                const { type, navKey, href, reportName } = button.dataset;
                if (type === 'dependency') {
                    navigationPath.push(navKey);
                    const nextLevel = getCurrentLevelObject();
                    if (nextLevel && nextLevel.reports) { 
                        navigationPath.push('reports');
                    }
                    displayOptions();
                } else if (type === 'report') {
                    const message = `¡Perfecto! Aquí tienes el acceso al informe: <br><strong class="font-semibold">${reportName}</strong>. <br><br><a href="${href}" target="_blank" class="text-blue-600 font-bold hover:underline" onclick="reportOpened()">🚀 Abrir Tablero de Power BI</a>`;
                    addBotMessage(message, { isHtml: true });
                }
            });
            ui.backBtn.addEventListener('click', () => {
                if (navigationPath.length > 0) {
                    if (navigationPath[navigationPath.length - 1] === 'reports') {
                        navigationPath.pop();
                    }
                    navigationPath.pop();
                    displayOptions();
                }
            });
            ui.breadcrumbContainer.addEventListener('click', (e) => {
                e.preventDefault();
                const link = e.target.closest('a');
                if (link && link.dataset.level === "-1") {
                    navigationPath = [];
                    displayOptions();
                }
            });
        });
    </script>
</body>
</html>