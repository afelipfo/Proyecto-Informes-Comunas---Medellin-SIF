<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUTASIF - Portal de consulta</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary-color: #0d47a1;
            --primary-color-dark: #003D6B;
            --secondary-color: #f57c00;
            --text-color: #212121;
            --text-color-light: #555;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --light-gray: #e9ecef;
            --status-red: #d9534f;
            --status-orange: #f0ad4e;
            --status-green: #5cb85c;
            --status-blue: #0275d8;
        }
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-color-dark));
            color: white;
            text-align: center;
            padding: 40px 20px 50px 20px;
            border-bottom: 5px solid var(--secondary-color);
        }
        .header-logo {
            max-width: 280px;
            margin-bottom: 25px;
            animation: fadeInDown 1s ease-in-out;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 900;
            line-height: 1.2;
            animation: fadeInUp 1s ease-in-out;
        }
        header p.subheading {
            font-size: 1.2em;
            margin: 10px 0 0 0;
            font-weight: 300;
            opacity: 0.9;
            animation: fadeInUp 1s ease-in-out 0.2s;
            animation-fill-mode: backwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        main > .intro-text {
            font-size: 1.15em;
            text-align: center;
            color: var(--text-color-light);
            max-width: 800px;
            margin: 40px auto -20px auto;
            line-height: 1.6;
        }

        section {
            padding: 60px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        main > section:last-of-type {
            border-bottom: none;
        }
        
        /* ===== ESTILOS DE TARJETAS UNIFICADOS ===== */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        /* ===== SECCIÓN CONSULTA COMUNA ===== */
        .consulta-comuna-container {
             display: flex;
             flex-direction: column;
             gap: 20px;
             padding: 30px;
             box-sizing: border-box;
        }
        .consulta-comuna-container h3 {
             font-size: 1.5em; margin-top: 0; margin-bottom: 5px; color: var(--primary-color); font-weight: 700;
        }
        .consulta-comuna-container p {
            font-size: 1em; color: var(--text-color-light); line-height: 1.6; margin-bottom: 10px;
        }
        .consulta-comuna-container label {
            font-size: 1em; font-weight: 600; color: var(--text-color); display: block; margin-bottom: 10px;
        }
        .consulta-comuna-container select {
            width: 100%; padding: 12px; font-size: 1em; border: 1px solid #ced4da; border-radius: 8px; margin-bottom: 10px; cursor: pointer; background-color: var(--bg-color);
        }
        .consulta-comuna-container button {
            background-color: var(--secondary-color); color: white; border: none; padding: 14px 20px; font-size: 1.1em; font-weight: bold; border-radius: 8px; width: 100%; cursor: pointer; transition: background-color 0.3s;
        }
        .consulta-comuna-container button:hover { background-color: #e66300; }

        /* ===== SECCIÓN INDICADORES ===== */
        #indicadores-detalle h2 {
            font-size: 2.2em; font-weight: 700; color: var(--primary-color); border-bottom: 3px solid var(--secondary-color); padding-bottom: 0.5em; margin-bottom: 1.5em; display: flex; align-items: center; gap: 15px;
        }
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 2.5em;
        }
        .indicator-card { /* Clase específica para no colisionar con .card genérica */
            padding: 1.8em; display: flex; flex-direction: column; border-top: 5px solid var(--secondary-color);
        }
        .card-header {
            display: flex; align-items: flex-start; gap: 12px; margin-bottom: 0.5em;
        }
        .card-header .icon {
            font-size: 1.6em; color: var(--primary-color); width: 40px; text-align: center; margin-top: 5px;
        }
        .card-header h3 {
            margin: 0; color: var(--primary-color); font-size: 1.20em; font-weight: 700; flex-grow: 1; line-height: 1.3;
        }
        .indicator-meta { text-align: right; }
        .indicator-id { font-size: 0.8em; color: #888; font-weight: 400; }
        .indicator-type-tag {
            font-size: 0.75em; font-weight: 700; padding: 3px 8px; border-radius: 12px; background-color: var(--light-gray); color: var(--text-color-light); display: inline-block; margin-top: 4px;
        }
        .card-body { margin-top: 1em; flex-grow: 1; }
        .main-metric {
            text-align: center; margin-bottom: 1.5em; padding: 1em; background-color: var(--light-gray); border-radius: 8px;
        }
        .main-metric .value {
            font-size: 2.8em; font-weight: 900; color: var(--text-color); line-height: 1.1;
        }
        .main-metric .value.small-text { font-size: 2.2em; }
        .main-metric .value span.unit {
            font-size: 0.4em; font-weight: 400; color: var(--text-color-light); margin-left: 5px;
        }
        .main-metric .label {
            font-size: 0.95em; color: var(--text-color-light); font-weight: 700; margin-top: 5px;
        }
        .details-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1em; font-size: 0.9em; margin-bottom: 1.5em;
        }
        .details-grid div {
            padding: 0.8em; background-color: var(--light-gray); border-radius: 8px; border-left: 3px solid #ced4da;
        }
        .details-grid strong {
            display: block; color: var(--primary-color); margin-bottom: 0.3em; font-weight: 700;
        }
        .progress-container { margin-top: auto; padding-top: 1em; }
        .progress-container label {
            font-size: 0.9em; color: var(--text-color-light); display: block; margin-bottom: 0.7em; font-weight: 700; text-align: center;
        }
        .progress-bar {
            background-color: var(--light-gray); border-radius: 25px; height: 22px; width: 100%; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .progress-bar-fill {
            height: 100%; border-radius: 25px; text-align: center; color: white; font-size: 0.85em; line-height: 22px; font-weight: bold; transition: width 0.8s ease-in-out, background-color 0.5s ease; background-color: var(--status-red); /* Default */
        }
        .progress-bar-fill.status-medium { background-color: var(--status-orange); }
        .progress-bar-fill.status-high { background-color: var(--status-green); }
        .progress-bar-fill.status-complete { background-color: var(--status-blue); }

        /* ===== ESTILOS DE CHATBOT Y FOOTER ===== */
        #chat-fab {
            position: fixed; bottom: 30px; right: 30px; background-color: var(--primary-color); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1001; transition: transform 0.3s;
        }
        #chat-fab:hover { transform: scale(1.1); }
        #chat-window {
            position: fixed; bottom: 100px; right: 30px; width: 420px; max-width: 90vw; height: 80vh; max-height: 700px; background: var(--card-bg); border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.25); display: flex; flex-direction: column; overflow: hidden; z-index: 1002; transform: scale(0.5); transform-origin: bottom right; opacity: 0; pointer-events: none; transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        #chat-window.visible { transform: scale(1); opacity: 1; pointer-events: auto; }
        .chat-header {
            background: var(--primary-color); color: white; padding: 15px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;
        }
        #chat-close-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; }
        .chat-body {
            font-family: 'Inter', sans-serif; flex-grow: 1; display: flex; flex-direction: column; background-color: #f0f4f8; height: 100%; overflow: hidden;
        }
        .chat-bubble-user { background-color: #2563EB; color: white; }
        .chat-bubble-bot { background-color: #E2E8F0; color: #1E293B; }
        #chat-messages-container::-webkit-scrollbar { width: 6px; }
        #chat-messages-container::-webkit-scrollbar-track { background: #CBD5E1; }
        #chat-messages-container::-webkit-scrollbar-thumb { background: #94A3B8; border-radius: 3px; }
        .option-btn {
            transition: all 0.2s ease-in-out; border: 1px solid #CBD5E1;
        }
        .option-btn:hover {
            transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-color: #3B82F6;
        }
        footer {
            text-align: center; margin-top: 4em; padding: 2em; border-top: 1px solid #ddd; color: #888; font-size: 0.95em;
        }
        footer strong { color: var(--text-color); }
        .reveal-on-scroll {
            opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; will-change: opacity, transform;
        }
        .reveal-on-scroll.is-visible { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

    <header>
        <img src="logo_footer.png" alt="Logo Alcaldía de Medellín" class="header-logo">
        <h1>Portal de consulta</h1>
        <p class="subheading">Secretaría de Infraestructura Física | Gestión 2025</p>
    </header>
    
    <main class="container">

        <p class="intro-text">
            ¡Te damos la bienvenida! Consulta las obras en tu comuna y explora en detalle los indicadores de gestión de nuestros proyectos estratégicos para la ciudad.
        </p>

        <section id="consulta-comuna" class="reveal-on-scroll">
            <div class="card" style="padding: 0; overflow: hidden;">
                <div class="consulta-comuna-container">
                    <h3><i class="fa-solid fa-map-location-dot"></i> Consulta por comuna</h3>
                    <p>Selecciona tu comuna para ver en detalle las intervenciones y proyectos que hemos realizado, que estamos realizando y que estamos por realizar en tu sector.</p>
                    <div>
                        <label for="comuna-select"><strong>Selecciona tu comuna o corregimiento:</strong></label>
                        <select id="comuna-select">
                            <option value="" disabled selected>-- Escoge una opción --</option>
                        </select>
                    </div>
                    <button onclick="abrirReporte()">
                        <i class="fa-solid fa-magnifying-glass"></i> Consultar
                    </button>
                </div>
            </div>
        </section>

        <section id="indicadores-detalle">
            <div class="chapter">
                <h2><i class="fa-solid fa-award"></i> Proyecto Estratégico: Medellín, Tacita de Plata</h2>
                <div class="cards-container">
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-bridge-water"></i><h3>Puentes vehiculares intervenidos</h3><div class="indicator-meta"><span class="indicator-id">4.1.1.6</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">8<span class="unit">Número</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 0,00% <br/>(0 de 0)</div><div><strong>2025:</strong> 40,0% <br/>(8 de 20)</div><div><strong>2026:</strong> 29,6% <br/>(Meta 27)</div><div><strong>2027:</strong> 25,8% <br/>(Meta 31)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 31)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 25.8%;">25,8%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-person-walking-luggage"></i><h3>Puentes peatonales intervenidos</h3><div class="indicator-meta"><span class="indicator-id">4.1.1.7</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">5<span class="unit">Número</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 0,00% <br/>(0 de 0)</div><div><strong>2025:</strong> 250,0% <br/>(5 de 2)</div><div><strong>2026:</strong> 17,2% <br/>(Meta 29)</div><div><strong>2027:</strong> 12,5% <br/>(Meta 40)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 40)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 12.5%;">12,5%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-chart-line"></i><h3>Estado de la malla vial</h3><div class="indicator-meta"><span class="indicator-id">4.1.3</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">7,66<span class="unit">Índice</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(7,66 de 7,66)</div><div><strong>2025:</strong> 57,1% <br/>(7,66 de 7,72)</div><div><strong>2026:</strong> 36,4% <br/>(Meta 7,80)</div><div><strong>2027:</strong> 26,7% <br/>(Meta 7,88)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 7,88)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 26.7%;">26,7%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-compass-drafting"></i><h3>Espacios públicos construidos y mejorados</h3><div class="indicator-meta"><span class="indicator-id">4.1.4.2</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">12.380<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(2.922 de 2.922 m²)</div><div><strong>2025:</strong> 18,4% <br/>(12.380 de 67.192 m²)</div><div><strong>2026:</strong> 8,2% <br/>(Meta 150.664 m²)</div><div><strong>2027:</strong> 5,8% <br/>(Meta 212.748 m²)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 212.748 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 5.8%;">5,8%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-toolbox"></i><h3>Espacios públicos mantenidos</h3><div class="indicator-meta"><span class="indicator-id">4.1.4.3</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">403.298<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(373.511 de 373.511 m²)</div><div><strong>2025:</strong> 100,8% <br/>(403.298 de 400.000 m²)</div><div><strong>2026:</strong> 89,6% <br/>(Meta 450.000 m²)</div><div><strong>2027:</strong> 80,7% <br/>(Meta 500.000 m²)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 500.000 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 80.7%;">80,7%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-city"></i><h3>Espacio público intervenido en el Centro</h3><div class="indicator-meta"><span class="indicator-id">4.1.4.4</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">2.445<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 0,00% <br/>(0 de 0 m²)</div><div><strong>2025:</strong> 74,4% <br/>(2.445 de 3.287 m²)</div><div><strong>2026:</strong> 28,0% <br/>(Meta 8.734 m²)</div><div><strong>2027:</strong> 7,5% <br/>(Meta 32.630 m²)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 32.630 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 7.5%;">7,5%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-shoe-prints"></i><h3>Andenes construidos y mejorados</h3><div class="indicator-meta"><span class="indicator-id">4.3.1.1</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">5.307<span class="unit">Metros</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(10.607 de 10.607 m)</div><div><strong>2025:</strong> 72,1% <br/>(5.307 de 7.360 m)</div><div><strong>2026:</strong> N.A. <br/>(Meta 7.360 m)</div><div><strong>2027:</strong> N.A. <br/>(Meta 7.360 m)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 32.687,00 m)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 48.7%;">48,7%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-person-walking-arrow-right"></i><h3>Andenes mantenidos</h3><div class="indicator-meta"><span class="indicator-id">4.3.1.2</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">2.167<span class="unit">Metros</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(100 de 100 m)</div><div><strong>2025:</strong> 21,7% <br/>(2.167 de 10.000 m)</div><div><strong>2026:</strong> 13,5% <br/>(Meta 16.000 m)</div><div><strong>2027:</strong> 10,8% <br/>(Meta 20.000 m)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 20.000,00 m)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 10.8%;">10,8%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-bicycle"></i><h3>Cicloinfraestructura urbana mantenida</h3><div class="indicator-meta"><span class="indicator-id">4.3.5.2</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">3,67<span class="unit">Km</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(1,00 de 1,00 Km)</div><div><strong>2025:</strong> 8,2% <br/>(3,67 de 45,00 Km)</div><div><strong>2026:</strong> 4,5% <br/>(Meta 81,00 Km)</div><div><strong>2027:</strong> 3,2% <br/>(Meta 116,50 Km)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 116,50 Km)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 3.2%;">3,2%</div></div></div></div>
                </div>
            </div>
            <div class="chapter">
                <h2><i class="fa-solid fa-train-tram"></i> Proyecto Estratégico: Metro de la 80</h2>
                <div class="cards-container">
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-person-digging"></i><h3>Obras ejecutadas en Metro de la 80</h3><div class="indicator-meta"><span class="indicator-id">4.1.2.3</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">32,33%<span class="unit">Avance</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(29,30% de 29,30%)</div><div><strong>2025:</strong> 92,4% <br/>(32,33% de 35,00%)</div><div><strong>2026:</strong> 71,8% <br/>(Meta 45,00%)</div><div><strong>2027:</strong> 64,7% <br/>(Meta 50,00%)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 50,00%)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 64.7%;">64,7%</div></div></div></div>
                </div>
            </div>
            <div class="chapter">
                <h2><i class="fa-solid fa-water"></i> Proyecto Estratégico: Parques del Río Norte</h2>
                <div class="cards-container">
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-water"></i><h3>Espacio público en Parques del Río Norte</h3><div class="indicator-meta"><span class="indicator-id">4.1.4.6</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">0<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 0,00% <br/>(0 de 0 m²)</div><div><strong>2025:</strong> 0,0% <br/>(0 de 0 m²)</div><div><strong>2026:</strong> 0,0% <br/>(Meta 28.000 m²)</div><div><strong>2027:</strong> 0,0% <br/>(Meta 56.000 m²)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 56.000 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 0%;">0,0%</div></div></div></div>
                </div>
            </div>
            <div class="chapter">
                <h2><i class="fa-solid fa-leaf"></i> Proyecto Estratégico: Indicadores evaluados por Medio Ambiente</h2>
                <div class="cards-container">
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-seedling"></i><h3>Infraestructura verde alternativa</h3><div class="indicator-meta"><span class="indicator-id">5.1.3.5</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">1.738<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(2.500 de 2.500 m²)</div><div><strong>2025:</strong> 64,4% <br/>(1.738 de 2.700 m²)</div><div><strong>2026:</strong> N.A. <br/>(Meta 2.700 m²)</div><div><strong>2027:</strong> N.A. <br/>(Meta 2.600 m²)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 10.500,00 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 40.4%;">40,4%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-tree"></i><h3>Área verde de corredores conservadas</h3><div class="indicator-meta"><span class="indicator-id">5.1.3.7</span><div class="indicator-type-tag">Mantenimiento</div></div></div><div class="card-body"><div class="main-metric"><div class="value small-text">1.153.474<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(2.000.000 m²)</div><div><strong>2025:</strong> 57,7% <br/>(1.153.474 de 2.000.000 m²)</div><div><strong>2026:</strong> N.A. <br/>(Meta 2.000.000 m²)</div><div><strong>2027:</strong> N.A. <br/>(Meta 2.000.000 m²)</div></div></div><div class="progress-container"><label>Indicador de Mantenimiento Anual (Meta 2.000.000 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 57.7%;">57,7%</div></div></div></div>
                </div>
            </div>
            <div class="chapter">
                <h2><i class="fa-solid fa-folder-open"></i> Proyecto Estratégico: Otros proyectos</h2>
                <div class="cards-container">
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-road-circle-check"></i><h3>Vías urbanas construidas y mejoradas</h3><div class="indicator-meta"><span class="indicator-id">4.1.1.1</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">9,83<span class="unit">Km</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,04% <br/>(9,39 de 9,39 Km)</div><div><strong>2025:</strong> 80,9% <br/>(9,83 de 12,15 Km)</div><div><strong>2026:</strong> 66,0% <br/>(Meta 14,91 Km)</div><div><strong>2027:</strong> 55,6% <br/>(Meta 17,68 Km)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 17,68 Km)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 55.6%;">55,6%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-screwdriver-wrench"></i><h3>Infraestructura vial urbana mantenida</h3><div class="indicator-meta"><span class="indicator-id">4.1.1.2</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">45,50<span class="unit">Km</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(35,80 de 35,80 Km)</div><div><strong>2025:</strong> 78,4% <br/>(45,50 de 58,00 Km)</div><div><strong>2026:</strong> 51,7% <br/>(Meta 88,00 Km)</div><div><strong>2027:</strong> 39,6% <br/>(Meta 115,00 Km)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 115,00 Km)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 39.6%;">39,6%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-tractor"></i><h3>Infraestructura vial rural intervenida</h3><div class="indicator-meta"><span class="indicator-id">4.1.1.3</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">7,77<span class="unit">Km</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(2,00 de 2,00 Km)</div><div><strong>2025:</strong> 82,7% <br/>(7,77 de 9,40 Km)</div><div><strong>2026:</strong> 47,7% <br/>(Meta 16,30 Km)</div><div><strong>2027:</strong> 33,8% <br/>(Meta 23,00 Km)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 23,00 Km)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 33.8%;">33,8%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-mountain-city"></i><h3>Obras para estabilización de taludes</h3><div class="indicator-meta"><span class="indicator-id">4.1.1.4</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">603,13<span class="unit">Metros</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(220,50 de 220,50 m)</div><div><strong>2025:</strong> 77,4% <br/>(603,13 de 779,50 m)</div><div><strong>2026:</strong> N.A. <br/>(Meta 100,00 m)</div><div><strong>2027:</strong> N.A. <br/>(Meta 100,00 m)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 1.200,00 m)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 68.6%;">68,6%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-money-bill-transfer"></i><h3>Recursos para Autopistas de la Prosperidad</h3><div class="indicator-meta"><span class="indicator-id">4.1.2.1</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">0<span class="unit">Millones de pesos</span></div><div class="label">Desembolso en 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 113,01% <br/>(89.296,30 de 79.014,00)</div><div><strong>2025:</strong> 0,0% <br/>(0 de 0)</div><div><strong>2026:</strong> N.A. <br/>(Meta 0)</div><div><strong>2027:</strong> N.A. <br/>(Meta 0)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 79.014,00)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 113%;">113,0%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-cable-car"></i><h3>Sistema teleférico de Palmitas mantenido</h3><div class="indicator-meta"><span class="indicator-id">4.1.2.2</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">1,30<span class="unit">Km</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(1,30 de 1,30 Km)</div><div><strong>2025:</strong> N.A. <br/>(1,30 de 0,00 Km)</div><div><strong>2026:</strong> 50,0% <br/>(Meta 2,60 Km)</div><div><strong>2027:</strong> 50,0% <br/>(Meta 2,60 Km)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 2,60 Km)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 50%;">50,0%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-road"></i><h3>Vías intervenidas en Proyectos de Desarrollo</h3><div class="indicator-meta"><span class="indicator-id">4.1.3.1</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">0,20<span class="unit">Km</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(0,20 de 0,20 Km)</div><div><strong>2025:</strong> 24,4% <br/>(0,20 de 0,82 Km)</div><div><strong>2026:</strong> 17,2% <br/>(Meta 1,16 Km)</div><div><strong>2027:</strong> 13,6% <br/>(Meta 1,47 Km)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 1,47 Km)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 13.6%;">13,6%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-ruler-combined"></i><h3>Espacio público intervenido en desarrollo</h3><div class="indicator-meta"><span class="indicator-id">4.1.3.2</span><div class="indicator-type-tag">Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">5.096<span class="unit">m²</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(2.922 de 2.922 m²)</div><div><strong>2025:</strong> 29,6% <br/>(5.096 de 17.234 m²)</div><div><strong>2026:</strong> 15,7% <br/>(Meta 32.561 m²)</div><div><strong>2027:</strong> 10,6% <br/>(Meta 47.889 m²)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 47.889 m²)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 10.6%;">10,6%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-book-open-reader"></i><h3>Parque Biblioteca Nororiental rehabilitado</h3><div class="indicator-meta"><span class="indicator-id">4.1.3.4</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">0,64%<span class="unit">Avance</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 100,00% <br/>(97,76% de 97,76%)</div><div><strong>2025:</strong> 28,6% <br/>(0,64% de 2,24%)</div><div><strong>2026:</strong> N.A. <br/>(Meta 0,00%)</div><div><strong>2027:</strong> N.A. <br/>(Meta 0,00%)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 100,00%)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 98.4%;">98,4%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-magnifying-glass-chart"></i><h3>Diagnóstico de espacios públicos</h3><div class="indicator-meta"><span class="indicator-id">4.1.4.7</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">0<span class="unit">Número</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 0,00% <br/>(0 de 0)</div><div><strong>2025:</strong> 0,0% <br/>(0 de 0)</div><div><strong>2026:</strong> N.A. <br/>(Meta 0,50)</div><div><strong>2027:</strong> N.A. <br/>(Meta 0,50)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 1,00)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 0%;">0,0%</div></div></div></div>
                    <div class="card indicator-card reveal-on-scroll"><div class="card-header"><i class="icon fa-solid fa-square-parking"></i><h3>Cicloparqueaderos instalados</h3><div class="indicator-meta"><span class="indicator-id">4.3.5.3</span><div class="indicator-type-tag">No Acumulado</div></div></div><div class="card-body"><div class="main-metric"><div class="value">8<span class="unit">Número</span></div><div class="label">Avance a 2025</div></div><div class="details-grid"><div><strong>2024:</strong> 0,00% <br/>(0 de 0)</div><div><strong>2025:</strong> 2,0% <br/>(8 de 400)</div><div><strong>2026:</strong> N.A. <br/>(Meta 300)</div><div><strong>2027:</strong> N.A. <br/>(Meta 300)</div></div></div><div class="progress-container"><label>Progreso Total (Meta 2024-2027: 1.000)</label><div class="progress-bar"><div class="progress-bar-fill" style="width: 0.8%;">0,8%</div></div></div></div>
                </div>
            </div>
        </section>

    </main>
    
    <footer>
        <p><strong>Mes de reporte: Julio de 2025</strong></p>
    </footer>

    <div id="chat-fab">
        <i class="fa-solid fa-robot"></i>
    </div>
    
    <div id="chat-window">
        <div class="chat-header">
            <span>Asistente Virtual SIF</span>
            <button id="chat-close-btn">✖</button>
        </div>
        <div class="chat-body">
            <div id="chat-messages-container" class="flex-grow p-4 overflow-y-auto space-y-4">
            </div>
            
            <div id="options-container" class="p-3 border-t bg-slate-50 space-y-3">
                <div id="navigation-controls" class="flex justify-between items-center text-sm mb-2">
                    <button id="back-btn" class="text-blue-600 hover:underline hidden">← Volver</button>
                    <div id="breadcrumb-container" class="text-slate-500 text-right font-medium"></div>
                </div>
                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                </div>
            </div>

            <div class="p-4 border-t bg-white rounded-b-xl">
                <div class="flex items-center space-x-2">
                    <input type="text" id="chat-input" placeholder="Pregúntame algo, como 'huecos' o 'parques'..." class="flex-grow border rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="send-btn" class="bg-blue-500 text-white rounded-full p-3 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // DATOS AUN DISPONIBLES PARA EL CHATBOT
        const pageData = {
            stats: {
                huecosTapados: "13,822",
                materialRemovido: "60,000 m³",
                personasEmergencias: "300",
                parquesRenovados: "17",
                parquesMetrosIntervenidos: "11,890 m²"
            },
            infraVerde: {
                corredores: 3,
                puentes: 3,
                metrosVerdes: "5,000 m²",
                jardineros: "540"
            },
            puente4Sur: {
                inversion: "$1.330 millones",
                plantas: "4.300"
            },
            parques: {
                inversionFutura: "$20.000 millones",
                cantidadFuturos: 29
            },
            proyectosEstrategicos: {
                puiEntregados: "4 PUI",
                puiInversion: "$16.000 millones",
                puiHabitantes: "209.000"
            },
            gestionEstrategica: {
                cuadrillasContrato: "Contrato Interadministrativo de $23.900 Millones para Atender Contingencias en el Espacio Público.",
                cuadrillasPuntosAtendidos: "152 puntos",
                licitacionesActivas: "12 procesos de licitación"
            }
        };
        
        function abrirReporte() {
            const select = document.getElementById('comuna-select');
            const comunaId = select.value;
            if (comunaId) {
                window.open(`comuna${comunaId}.html`, '_blank');
            } else {
                alert('Por favor, selecciona una comuna.');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            
            // --- Lógica para Comunas ---
            const communeData = [
                { name: 'Comuna 1 – Popular', id: 1 }, { name: 'Comuna 2 – Santa Cruz', id: 2 },
                { name: 'Comuna 3 – Manrique', id: 3 }, { name: 'Comuna 4 – Aranjuez', id: 4 },
                { name: 'Comuna 5 – Castilla', id: 5 }, { name: 'Comuna 6 – Doce de Octubre', id: 6 },
                { name: 'Comuna 7 – Robledo', id: 7 }, { name: 'Comuna 8 – Villa Hermosa', id: 8 },
                { name: 'Comuna 9 – Buenos Aires', id: 9 }, { name: 'Comuna 10 – La Candelaria', id: 10 },
                { name: 'Comuna 11 – Laureles-Estadio', id: 11 }, { name: 'Comuna 12 – La América', id: 12 },
                { name: 'Comuna 13 – San Javier', id: 13 }, { name: 'Comuna 14 – El Poblado', id: 14 },
                { name: 'Comuna 15 – Guayabal', id: 15 }, { name: 'Comuna 16 – Belen', id: 16 }
            ];
            const selectComuna = document.getElementById('comuna-select');
            communeData.forEach(commune => {
                const option = document.createElement('option');
                option.value = commune.id;
                option.textContent = commune.name.replace(/–\s/g, '- ');
                selectComuna.appendChild(option);
            });
            
            // --- Lógica de Animaciones y Estilos Dinámicos ---
            const animatedElements = document.querySelectorAll('.reveal-on-scroll');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        
                        // Si el elemento es una tarjeta de indicador, aplicar lógica adicional
                        if (entry.target.classList.contains('indicator-card')) {
                            const progressBarFill = entry.target.querySelector('.progress-bar-fill');
                            if (progressBarFill) {
                                const widthPercent = parseFloat(progressBarFill.style.width);
                                if (widthPercent >= 100) {
                                    progressBarFill.classList.add('status-complete');
                                } else if (widthPercent > 75) {
                                    progressBarFill.classList.add('status-high');
                                } else if (widthPercent > 30) {
                                    progressBarFill.classList.add('status-medium');
                                }
                            }
                            const metricValue = entry.target.querySelector('.main-metric .value');
                            if (metricValue && metricValue.textContent.length > 7) {
                                metricValue.classList.add('small-text');
                            }
                        }
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            animatedElements.forEach(el => {
                observer.observe(el);
            });
            
            // --- Lógica del Asistente Virtual ---
            const reportesSIF = {
                planeacion: { name: "Subsecretaría de Planeación", unidades: { gestion_informacion: { name: "Unidad de Gestión de la Información y Proyectos", reports: [ { name: "Ejecución Presupuestal", keywords: ['presupuesto', 'ejecución', 'plata', 'inversión'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNDAyOGE4OTMtZTExMi00M2VlLWJiNmUtMTMwMzk3MjY0YmU3IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Quiero ver cómo se invierte el presupuesto"] }, { name: "Indicadores PI", keywords: ['indicadores', 'pi', 'avance'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMDk4YTEyZTMtY2FlZi00Y2Y0LWI2ODgtNDZiYTgxN2EzZDMyIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo van los indicadores de rendimiento?"] }, { name: "Informe Tácita de plata", keywords: ['tácita', 'plata'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjliYjNkNGQtYjJiMC00MDRhLWJlZDMtYjk4YmI1YjMwZjUzIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Muéstrame el informe de Tácita de Plata"] } ] }, estudios_disenos: { name: "Unidad de Estudios y Diseños", reports: [ { name: "Parques - Tejiendo Hogares", keywords: ['parques', 'tejiendo hogares'], href: 'https://app.powerbi.com/view?r=eyJrIjoiN2Y1ZTQyNGQtOTkzZC00MjY4LTg5NzktZWY1NzNiYjE2NzBkIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver el impacto del proyecto 'Tejiendo Hogares'"] } ] }, gestion_contractual: { name: "Unidad de Gestión Contractual", reports: [ { name: "Proceso Precontractual", keywords: ['precontractual', 'contratos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMzE1MWNmMjQtYWEyMy00MGVjLWI4MjgtNzIzZTYxZDAzNDVhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué proyectos se van a contratar pronto?"] } ] } } },
                construccion: { name: "Subsecretaría de Construcción y Mantenimiento", unidades: { ejecucion_proyectos: { name: "Unidad de ejecución de Proyectos", reports: [ { name: "Seguimiento a contratos de Obra", keywords: ['contratos', 'obra'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNTI2N2NhMjktN2RmOS00OTliLTg1Y2UtMjY2M2Q5MDcxOTY0IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo van las obras en construcción?"] }, { name: "Empleabilidad", keywords: ['empleabilidad', 'empleo'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNjUyOWI4ZmQtZWIzNi00NjM2LTlkOGUtOGM0OTUwNjY1MmNmIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver el impacto en la generación de empleo"] }, { name: "Informe Baches", keywords: ['baches', 'huecos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNWI3ZTNkZmMtMjEyNy00NjU1LTk3YzktNTMyOGJkMzZlN2ZiIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Quiero ver el mapa de reparación de huecos"] }, { name: "Informe Paraderos", keywords: ['paraderos'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZDQ2OGM4MDItYTc1Zi00MjE5LWJlNmUtZjJhMDE3ZjkzMWFjIiwidCI6ImJhMzM0NGUyLTAxMGYtNGJkZi1iNTEyLWMzOGRmYTdhNWJhNSIsImMiOjR9', preguntas: ["¿Cómo va la renovación de paraderos?"] } ] }, socioambiental_paisajismo: { name: "Unidad Socioambiental y Paisajismo", reports: [ { name: "Jardín Botánico*", keywords: ['jardín', 'botánico'], href: 'https://app.powerbi.com/view?r=eyJrIjoiOGQwNzU5ODgtNmIyYS00YTQ3LTg3ODMtOGRhOTU2MmMyNjZhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver proyectos con el Jardín Botánico"] }, { name: "Parque Arví*", keywords: ['arví'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMDkyNjU3Y2UtOTRjNy00YjVjLTg0MzgtNzBiYmUyOWNhNzEwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué se está haciendo en el Parque Arví?"] } ] }, mantenimiento: { name: "Unidad de Mantenimiento", reports: [ { name: "Trabajadores Oficiales", keywords: ['trabajadores', 'oficiales'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNWM1NzY3MjQtZmViMy00YmRiLWJiODgtMDg0MDRhZjVkMTgzIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Conocer sobre los trabajadores oficiales"] }, { name: "Solicitudes Baches SIRO", keywords: ['siro', 'solicitudes baches'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNzkzZmIyODUtMGE3YS00YTUwLTkyYTMtMTBlODI3MWE4OWU2IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar el estado de mi solicitud de un bache"] }, { name: "Parque Automotor", keywords: ['automotor', 'vehículos', 'maquinaria'], href: 'https://app.powerbi.com/view?r=eyJrIjoiNmQ1ZThhNWItZTA1Mi00ZDc4LTgwMTktYWEyYzViOTY1YTNhIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Explorar el estado del parque automotor"] }, { name: "Intervenciones Directas", keywords: ['intervenciones', 'directas'], href: 'https://app.powerbi.com/view?r=eyJrIjoiYjE2NjE2MjItNTUxNi00ZTI4LThmNzAtNjY0NThjNGYxN2Q2IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver las pequeñas obras en los barrios"] }, { name: "Permisos de Roturas*", keywords: ['roturas', 'permisos'], href: '#link-placeholder', preguntas: ["Entender la gestión de permisos de roturas"] } ] } } },
                despacho: { name: "Despacho SIF", reports: [ { name: "Gerencia de Corregimientos", keywords: ['corregimientos', 'gerencia', 'rural'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZmVhNjY3YTYtNTIwNi00NzUzLTkyYWYtZmZiMDBiNTdkNWQwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Qué obras hay en los corregimientos?"] }, { name: "Informe Calamidad Pública", keywords: ['calamidad', 'pública', 'emergencias'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjEyMzdhNGEtZGVjNC00YTM4LWEzNDAtMjI1MmY1NzdlODEwIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Ver informe de gestión de emergencias"] }, { name: "Plan de Contratación", keywords: ['plan', 'contratación', 'licitaciones'], href: 'https://app.powerbi.com/view?r=eyJrIjoiMjgzYmIxZTctMmM1Yi00YWEzLWIyYTktYjk3ODYxNGI3NTY4IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar el plan anual de adquisiciones"] }, { name: "Informe de Gestión", keywords: ['gestión', 'informe de gestión', 'resumen'], href: '#link-placeholder', preguntas: ["Quiero un resumen de la gestión"] } ] },
                direccion: { name: "Dirección Técnica", reports: [ { name: "Estado proyectos estratégicos", keywords: ['estratégicos', 'proyectos', 'metro 80'], href: 'https://app.powerbi.com/view?r=eyJrIjoiYzEzZGI3ZTUtNDc1ZS00ODdjLTg1YTctYTA1OGZjYzdmMTVlIiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["¿Cómo avanzan los proyectos estratégicos?"] } ] },
                apoyo_juridico: { name: "Apoyo Jurídico", reports: [ { name: "Acciones Populares", keywords: ['acciones', 'populares', 'demandas'], href: 'https://app.powerbi.com/view?r=eyJrIjoiZWY3ZDM3ODctMGFmYS00OTlmLWJlYTgtMmViNTE5NmZmYjA5IiwidCI6IjljNDhlMDg4LTVlNDQtNGIwZC05M2EwLWVlYjJjNjEyN2MzZCIsImMiOjR9', preguntas: ["Consultar estado de acciones populares"] } ] },
                comunicaciones: { name: "Comunicaciones", reports: [] },
                unidad_administrativa: { name: "Unidad Administrativa", reports: [] }
            };
            const faqData = {
                'huecos': { keywords: ['hueco', 'bache', 'malla vial'], answer: `¡Hemos trabajado sin descanso en la malla vial! A la fecha, la cifra es de <strong>+${pageData.stats.huecosTapados} huecos</strong> tapados en la ciudad y los corregimientos. ¡Seguimos sumando para mejorar tu movilidad! 🚧` },
                'infraVerde': { keywords: ['verde', 'jardines', 'árboles'], answer: `¡Medellín es un jardín! Hemos creado <strong>${pageData.infraVerde.corredores} nuevos corredores verdes y ${pageData.infraVerde.puentes} puentes</strong>, que suman <strong>${pageData.infraVerde.metrosVerdes}</strong> de nuevos espacios para todos. Además, más de <strong>${pageData.infraVerde.jardineros} jardineros</strong> cuidan de ellos. 🌳` },
                'puente4Sur': { keywords: ['4 sur', 'cuatro sur'], answer: `¡El puente de la 4 Sur está más verde que nunca! Invertimos más de <strong>${pageData.puente4Sur.inversion}</strong> en su renovación y sembramos más de <strong>${pageData.puente4Sur.plantas} plantas</strong> para embellecerlo. 🌉` },
                'parques': { keywords: ['parque', 'juegos'], answer: `¡Claro que sí! Hemos renovado <strong>${pageData.stats.parquesRenovados} parques</strong> y espacios públicos. Y la buena noticia es que viene una inversión de más de <strong>${pageData.parques.inversionFutura}</strong> para mejorar y construir otros <strong>${pageData.parques.cantidadFuturos} parques</strong>. ¡Más lugares para disfrutar! 🏞️` },
                'pui': { keywords: ['pui', 'proyectos urbanos'], answer: `Los Proyectos Urbanos Integrales (PUI) transforman barrios enteros. Ya entregamos <strong>${pageData.proyectosEstrategicos.puiEntregados}</strong> con una inversión de <strong>${pageData.proyectosEstrategicos.puiInversion}</strong>, beneficiando a más de <strong>${pageData.proyectosEstrategicos.puiHabitantes} personas</strong>. 💪` },
                'cuadrillas': { keywords: ['cuadrillas', 'alcalde'], answer: `Las Cuadrillas del Alcalde son nuestros equipos de respuesta rápida. Con un contrato de <strong>${pageData.gestionEstrategica.cuadrillasContrato.split(" ")[4]}</strong>, ya han atendido <strong>${pageData.gestionEstrategica.cuadrillasPuntosAtendidos}</strong> de la ciudad para reparaciones y mantenimiento. 👷‍♂️` },
                'licitacion': { keywords: ['licitación', 'licitaciones', 'contratación'], answer: `Para garantizar que las obras no paren, actualmente tenemos <strong>${pageData.gestionEstrategica.licitacionesActivas}</strong> abiertos para malla vial, parques, andenes y mucho más. ¡El futuro de Medellín se sigue construyendo! 🏗️` }
            };
            const fab = document.getElementById('chat-fab');
            const chatWindow = document.getElementById('chat-window');
            const closeBtn = document.getElementById('chat-close-btn');
            
            const ui = {
                chatMessages: document.getElementById('chat-messages-container'),
                chatInput: document.getElementById('chat-input'),
                sendBtn: document.getElementById('send-btn'),
                optionsGrid: document.getElementById('options-grid'),
                breadcrumbContainer: document.getElementById('breadcrumb-container'),
                backBtn: document.getElementById('back-btn'),
            };
            
            let botTyping = false;
            let navigationPath = [];
            function addMessage(content, sender, options = {}) {
                const bubble = document.createElement('div');
                bubble.className = `max-w-xs md:max-w-lg p-3 rounded-xl ${sender === 'user' ? 'chat-bubble-user self-end' : 'chat-bubble-bot self-start'}`;
                bubble.innerHTML = options.isHtml ? content : content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                ui.chatMessages.appendChild(bubble);
                ui.chatMessages.scrollTop = ui.chatMessages.scrollHeight;
            }
            function addBotMessage(text, options = {}) {
                if (botTyping) return;
                botTyping = true;
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'chat-bubble-bot self-start p-3 rounded-xl flex items-center space-x-2';
                typingIndicator.innerHTML = `<span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0s;"></span><span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span><span class="block w-2 h-2 bg-slate-400 rounded-full animate-bounce" style="animation-delay: 0.4s;"></span>`;
                ui.chatMessages.appendChild(typingIndicator);
                ui.chatMessages.scrollTop = ui.chatMessages.scrollHeight;
                setTimeout(() => {
                    if (typingIndicator.parentNode) {
                        ui.chatMessages.removeChild(typingIndicator);
                    }
                    addMessage(text, 'bot', options);
                    botTyping = false;
                }, 800 + Math.random() * 400);
            }
            function getCurrentLevelObject() {
                let level = reportesSIF;
                for (const key of navigationPath) {
                    level = level[key];
                    if (level && level.unidades) {
                        level = level.unidades;
                    }
                }
                return level;
            }
            function displayOptions() {
                const currentLevel = getCurrentLevelObject();
                ui.optionsGrid.innerHTML = '';
                ui.backBtn.classList.toggle('hidden', navigationPath.length === 0);
                updateBreadcrumbs();
                if (Array.isArray(currentLevel)) {
                    if (currentLevel.length === 0) addBotMessage('Aquí no hay más informes, ¡pero puedes volver y explorar otra sección! 😉');
                    currentLevel.forEach(report => {
                        const randomQuestion = report.preguntas[Math.floor(Math.random() * report.preguntas.length)];
                        createButton(randomQuestion, 'report', { href: report.href, reportName: report.name });
                    });
                } else { 
                    if (Object.keys(currentLevel).length === 0) addBotMessage('Parece que esta sección está vacía. ¡Intenta en otro lugar!');
                    for (const [key, value] of Object.entries(currentLevel)) {
                        createButton(value.name, 'dependency', { navKey: key });
                    }
                }
            }
            function createButton(name, type, data) {
                const button = document.createElement('button');
                button.className = 'option-btn bg-white text-slate-700 text-sm font-medium p-3 rounded-lg hover:bg-slate-50 text-left';
                button.innerHTML = `<span class="font-bold">${name}</span>`;
                button.dataset.type = type;
                for (const [key, value] of Object.entries(data)) {
                    button.dataset[key] = value;
                }
                ui.optionsGrid.appendChild(button);
            }
            function updateBreadcrumbs() {
                if (navigationPath.length === 0) {
                    ui.breadcrumbContainer.innerHTML = 'Inicio';
                    return;
                }
                let pathText = `<a href="#" class="hover:underline" data-level="-1">Inicio</a>`;
                let level = reportesSIF;
                navigationPath.forEach((key) => {
                    level = level[key];
                    pathText += ` / ${level.name}`;
                    if (level.unidades) level = level.unidades;
                });
                ui.breadcrumbContainer.innerHTML = pathText;
            }
            function searchAllReports(obj) {
                let reports = [];
                for (const key in obj) {
                    if (key === 'reports') {
                        reports = reports.concat(obj[key]);
                    } else if (typeof obj[key] === 'object' && obj[key] !== null) {
                        reports = reports.concat(searchAllReports(obj[key]));
                    }
                }
                return reports;
            }
            function handleUserInput() {
                const userInput = ui.chatInput.value.trim();
                if (userInput === '' || botTyping) return;
                addMessage(userInput, 'user');
                ui.chatInput.value = '';
                generateBotResponse(userInput);
            }
            function generateBotResponse(input) {
                const lowerInput = input.toLowerCase();
                const allReports = searchAllReports(reportesSIF);
                const foundReport = allReports.find(report => 
                    report.name.toLowerCase().includes(lowerInput) || 
                    report.keywords.some(kw => lowerInput.includes(kw))
                );
                if (foundReport) {
                    const message = `¡Excelente! Encontré justo lo que buscas. Aquí tienes el acceso directo al informe sobre <strong class="font-semibold">${foundReport.name}</strong>. ¡Espero que los datos te sean de mucha utilidad! <br><br><a href="${foundReport.href}" target="_blank" class="text-blue-600 font-bold hover:underline" onclick="reportOpened()">🚀 Abrir Tablero de Power BI</a>`;
                    addBotMessage(message, { isHtml: true });
                    return;
                }
                for (const key in faqData) {
                    if (faqData[key].keywords.some(kw => lowerInput.includes(kw))) {
                        addBotMessage(faqData[key].answer, { isHtml: true });
                        return;
                    }
                }
                const notFoundMessage = "Vaya, parece que no encontré nada con esas palabras exactas. 🤔 No te preocupes, a veces los términos técnicos pueden ser confusos. ¿Qué tal si intentas con una palabra más general como 'contratos', 'inversión' o 'parques'? O si prefieres, sigue explorando las opciones de abajo.";
                addBotMessage(notFoundMessage, { isHtml: true });
            }
            window.reportOpened = () => {
                addBotMessage("¡Perfecto! Abriendo el informe en una nueva pestaña. Si necesitas algo más, no dudes en preguntar. 😊");
            };
            fab.addEventListener('click', () => {
                chatWindow.classList.toggle('visible');
                if (chatWindow.classList.contains('visible') && ui.chatMessages.children.length === 0) {
                     addBotMessage("¡Hola! Soy SIF, tu asistente virtual de la Secretaría de Infraestructura. 😊 Estoy aquí para ayudarte a navegar por todos nuestros datos y proyectos. ¿Qué información te interesa hoy? Puedes explorar las categorías de abajo o preguntarme directamente por algo como 'huecos tapados' o 'nuevos parques'.");
                     displayOptions();
                }
            });
            closeBtn.addEventListener('click', () => chatWindow.classList.remove('visible'));
            ui.sendBtn.addEventListener('click', handleUserInput);
            ui.chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserInput(); });
            ui.optionsGrid.addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn');
                if (!button) return;
                const { type, navKey, href, reportName } = button.dataset;
                if (type === 'dependency') {
                    navigationPath.push(navKey);
                    const nextLevel = getCurrentLevelObject();
                    if (nextLevel && nextLevel.reports) { 
                        navigationPath.push('reports');
                    }
                    displayOptions();
                } else if (type === 'report') {
                    const message = `¡Perfecto! Aquí tienes el acceso al informe: <br><strong class="font-semibold">${reportName}</strong>. <br><br><a href="${href}" target="_blank" class="text-blue-600 font-bold hover:underline" onclick="reportOpened()">🚀 Abrir Tablero de Power BI</a>`;
                    addBotMessage(message, { isHtml: true });
                }
            });
            ui.backBtn.addEventListener('click', () => {
                if (navigationPath.length > 0) {
                    if (navigationPath[navigationPath.length - 1] === 'reports') {
                        navigationPath.pop();
                    }
                    navigationPath.pop();
                    displayOptions();
                }
            });
            ui.breadcrumbContainer.addEventListener('click', (e) => {
                e.preventDefault();
                const link = e.target.closest('a');
                if (link && link.dataset.level === "-1") {
                    navigationPath = [];
                    displayOptions();
                }
            });
        });
    </script>
</body>
</html>